import { TezosToolkit } from '@taquito/taquito';
import { InMemorySigner } from '@taquito/signer';
import { setupServer } from 'msw/node';
import { rest } from 'msw';

import blockHeader from './data/block_header.json';
import protocolConstants from './data/constants.json';
import contractResponse from './data/bridge.contract.json';
import contractScriptResponse from './data/bridge.script.json';
import entrypoints from './data/bridge.entrypoints.json';
import * as IBCF from '../../src';

const signer_address = 'tz1YGTtd1hqGYTYKtcWSXYKSgCj5hvjaTPVd';
const contractAddress = 'KT1PgvJ629MCN99k9EKYTaWZJXB9zd5bzvzd';

describe('Tezos > Bridge', () => {
    const server = setupServer(...http_handlers('http://mocked_rpc.localhost'));
    const tezos_sdk = new TezosToolkit('http://mocked_rpc.localhost');
    const contract = new IBCF.Tezos.Contracts.Bridge.Contract(tezos_sdk, contractAddress);

    beforeAll(async function () {
        tezos_sdk.setSignerProvider(
            await InMemorySigner.fromSecretKey(
                'edskS8xUePnvXXp3XHjYkDBBKDRwigGF95uHtJzDakV74azm9y6KHvkw4gLjPUvenWiY7H9xRQN729ipPutLVLiHXHMYfaf9hS',
            ),
        );
        server.listen();
    });

    afterAll(function () {
        server.close();
    });

    it('getStorage', async () => {
        const contractStorage = await contract.getStorage();

        expect(contractStorage.asset_address).toEqual('KT1WcYP4Tag4XkbehcLjQ2rG485zRw31amSi');
        expect(contractStorage.eth_bridge_address).toEqual('f8d0dcb8f3af348586360971b3561b3b139a2929');
    });

    it('computeUnwrapProofKey', async () => {
        const proofKey = await contract.computeUnwrapProofKey(10);

        expect(proofKey).toEqual('0a');
    });

    describe('Entrypoints', () => {
        it('wrap', async () => {
            const result = await contract.wrap({
                account_proof_rlp:
                    '0x307866393064313366393032313161306361323138333134323638373664656232363766623836366330343434313534346535636435326163663462366261323031656666383635343335393366376661303336666633386635353033323631396235393935393630373361323235626136383537303365646234333933336536346234336333353630356430356335386561303835316662306464383537656261653135356665306164303565636335613230636430663930356530363635393861396465363763313265663865386431663861306461323564336462373737393566356634656466396139653865346432653061623566313661663231643864616538333664616639303138623337663033643361306332383462303939333266373338633363396630643633633264303633623734346362393639326262363665626430323037333032333361376264656665623361306639346662643730616461366439613864343139643139396534656533636633346236343763613563653530643263366536646333353663303765646133663861306632636531343137613635363933356364613237383130306163343138356130666531346661663666313661626231363930323236346365633264626639343561306161646431376530306538633663613237363231336266626637386437376464643865386162313866633762363230633533303138346236633639613265386161303031636539623331383733616162323938653530306334346664346364393635316133383235623734653035363437626234323439333531303662373661613161306437303338636335323535623261396630333865303763323763656537666665353533666664646365356335636166313864316530636635396230353839343261303531333262613030626338333634326533313665383230383739376631316430383566313830626430366135623865363331333438613861396533303661366661303161633433393664353637363433396631336564633530356632333365613862666634333134336531376237643832616438336234323430303663383634373961303739376164653731366536663737653263643065373630666638336337643164643661386239366161383831303533366130326634613933336463346361623961303937313562303036623131623834613464666539643232653332626461326538633138653661613439313665373861306562633935316239616434316462333361303837343431396637373035323463396533613565666635376635343939383032396631623733623065626631336639646165633832633761323233663333643061303435326336353032643432343864373061646462393336343465643238646534343364396635613130376232356533666235313465656139323336376661613138306639303231316130383836386535363036653830373338626437626238393265626238643165303731663830303134633637303761366230313663363834653366333830613731616130393230346634373162326639616539373838393763333932626133633933396230333136373264396263613966356663306539623830373064303931333965316130616231373834326266353838333963386538313939633635343966323533613866336661306165623030666166303166316130333234666530326563376230346130643334323637393336656261393136636438626638383339383062633865643162623639313961633831623131393861383332613138343133386365333661376130363834303438303037373262636339303432393263376332616665363237393932623632393031613562343363303233623832346663353262636632383261316130356235613931316535303231613731333361383162643934393561333338373734636264646463373166653032343532303236626533373064653263663338646130383564306632386536323139626132363936666166356230366661613636343039633734303337613564373032336366616435336632633539343563653131396130626666346663643539336133326637333331393930623131333239336532333331616334353838636663383934626464663339633564626161643364616264306130656235366461396161313834613230336661386533306235636536393730333336383735636663653834656165373130313938313161303734643332343661636130636261333436303638636531653061613537383831633032663165313735356532366463316239386464653739303937316362366639663530346436623837306130316432343838326661346231616664643333653138313366353332613038303133613439323564373732383933346336353436303866633862616261333934396130303230343461383030666634353233313762373531613064616330626563303739633861393334633761353462303833313338356161393831646134313534656130613730333361303065353938353430636439326433393465326537393566323366343864363737393266353865306161343738373338316638383937303530316130643566343736346665373436393937353731663832333737643163613062616131363464366337306435643163633337326162383562356462636665666366306130393361353066316131373032323634636439303764326234653238343037636462643333623463373364343761653163346634383636343861316362316638636130656533626239623730316662333039643262313735663737653463653335353631373766333639376133333962373161323430323731626463666462336562343830663930323131613035353661656462396262333132663362663561636133623765346262653833616438373235643737303962643030653164653630636566343062646638393831613030303130666630613834363133393731363437336135336136333337313036613031316330313265633433313731373837623361316133656637653735323932613035343935376635353663393830316666613833343332623063656538393436356630336630303166376330333762623962303761303963646538616665653438613036666264346630653964663835373333616239616538393966393539386537326630643965303432373338623636366362633365386633643739393133343666613064313034303362326135653839313463343062393464306432383866663961363662373930326366323865346630343865636338666566643238306133373665613033666634336535626132613761383630313336633631343835646537623033356437613362383666633132356662663634643735336136303339323033613762613034643364643338316162303166643138383631303037306432623032323761346630376464393030323435653061613532373462316336363935343831376339613036356333323265643636343765616264613336373531353132383631323363613964313536396266366162613631343630623331306132653938653032353836613031656663373438663631616437396161633336343032653636633861376466303465613136656332626539396365666430653533356366623135393465343036613033653064666261366635306638646334663462306166373163323038613365666164653437353330343737643265363232653465376162373831643261393065613063623061303634366130663463666565626434656166646362343637613031616232643963306531376363343561613638633630336164363234333233323831613034356431663536633263376561343539656535373232636334326634643835356537656131626562386536623333623262646236356638323736666330303463613036343733616263373036393661363961633563346532396630306231346331373962323735646538613062346233623232336336386134646135306633356538613036343364393739653830306534313261383435333537336463643532326438636662363036303261393962343233323139386332346134393433666236353334613032616433303932626634313061653439306639373639653166623637383234656633626137363330353132616335373565316163326133646632633963663731613063363132323439313030643266653234653334623434646362643433326433663334363730376231663133623663646532623437383063393133636361346438383066393032313161303131626538623566623838666637616132386330396366616663626135613932363661386336616237343135666563323362653962303565323539313435343961306265356234326139656530636530326430663137613565343134376332663331623435366130316563353631376661623262393066666532373663623239323761303937393636333335383135656563633339326439363230316333373336633262653762356337376264356238303061306335653139643737303363626139373461306139343632383562633538393864666234663833663636346163636636323836346134653664653034373739333531366235633661333566326433386564343361306538373832376166656538616335303232336334313666363039306633636661366330393661643665636566346265363862373736303339633662396535656261303033666564613234346165373735346565643366343966303733613462363030326433613030626533333133373038336263653938306636393164333765636161303734626637363732636134386465313132633462656537643532343637303262363836316432316436653833653565613338653134376664313932626235633061306538623566363439366338626332613966346562306635656564613733616434343936643536316334336666643638356162396234626636623164386436633461306263663334383164333062373236653235393662353466306338393730303065303965316565636466336464333337613433663332396234313536666432336361306566383539323766373366623665613533343130326230623536356238306334646439353534323332323638653536663465663337353937353738643435366261303937373464653163613833383337623264356364663135663062346566356334626539346631643534346336303631653866383833333866346134326237303461306239646130396333386134303130343163653331376361626663323961633837633461313365613438363462306463363338316333396666393931343734613161306430653735643639663930356465383439303030366562336365306661666231666132623133363264306333393337666137366636633863613866383433616361303765336636396237616366333431323561303135326132623738346562333166653639333031336335366636346166326261666461313037643833373765393561303536623736666339623365663664393233396136386533386461646562646635336131383736303564346135323937386365386564356336643933313864383761306237363735366139636433396662613336346135373433316162363736633933643733323138386338363566356136333065306364343962373064313265613138306639303231316130313635623464336264343063666661363332373433313835313064336630363634313262383330383136333061656436633739393463373639376232663830396130346331346433353636386131623836633939333164366431356138393637643936306661663561653662393961643836396139383166353132303335623230356130323735393039383463346566376338363965666431313032653834613335396461383631383265373531333531343335323333623962326334353065353538636130376234643365353338373931346138623936373232623434323539313236636239313739623131396630383938616635626339656462633665313130383361616130646336356664626430623231376338393265663131666361663061613866643432353836366363343835353832333161333063356138646465646430346532656130326533336231326431336239343431356337343536323131623834666262666364326662663936623335646662643839376535343538663633663539373837316130623361316630376161323036393636626231323864333038616163363965396330346438303739313839653932333638376530306230393537323435376165376130373338313365306230653165303537663731366661333135643436353762356634316662646530303136653332613238636665333065623136653231613865656130383439376665383763616266333263363538323735626131363231373130313633656633613435323065313035313030343366323766336630383264396638616130363865303335303433313766623934653337353338613832613034303865643165613363313136306232326238313562646663363266303931636237343937646130613432326138353766636135383438393363333834346434346561343337363430306637346363663464396666623332666330363332373462613830373736396130616634393064313032353861306630376231303035663336336433623164393134363663343966633462323561306161626438623437633964316361613932356130636132313433353866336431333262313863613463666661373330663830623734666339366230383236643132666634663566656531373032323665393536386130663162626335313866373166353838313035616262383038343334333966396538613934373636343933393339356434366536653331646632396335386437666130353834336464386533316361653432616564363635623536376430303465393839386435323561353933386365336262386666633862393462363030303034636130303935383031336461633464663632616632366336316665633730623663326230303066623665313231613363353135363636343836356233306464343661633830663930316631613038663465623762356438323162396232343535316534313132386438613462336465363533616264386138643830373431643332666335643063643537643933613030633530363065666164353732333838636539616661663931343838653039306430653732363566356232613831396263346634356634343931333633656539613063343965613332316465353331316562343436376561373430313134396232393863383631353335633336383963656634306435303462656136633933616165613030663663303430386166376362366665346565333434396661653239333331636162666638636337663963376666643161383735653235656630336263623431613063393665666264333936333039326164353735353335666666363137346133313037653134656361653166626165343966303233303064656361363264323138613037623633323438633466303539616337653634353035663739353639636437613462383666343461363233353632383566613237326438343462363264643863613032386266646437343866393662303033343130666232306433356534383533386262313033363364316330633431643762383338346662333231356239343839613062373662643839386137323664303564306231663463393934383736656162396639316435346138663338366564383864396236346531353439333039653963613065313261396331666638663938376366353334666162373333653134393135656231313930313666303934626366396430326665633362643332336136386366613036363965633161383363333564356433663261633161653632626439373361666232383831633332646230373630626462323433613730333838356562663037613038306161393565386466666239613234663563313638316437653063616437623366646534316366396332623961336564363035353032343533313437376636613037663535363833633339343764623166376238323565326230643665653134373664613935333730633837396236343035636435313933613065666362333061613032333630653933363231303435663232633264643930323138616631613037393065656430636432366263383136653835386562306333356630383762376635383061303435303533393437623433396636326632623136663431653833656234633138373362396265376365353336326163663132326131353335623864356131303361303665653630366631653937303362386438363466373132636365386433373137396138653739383633373930336533313830363535346637326435353437353438306638353138303830383038303830383038306130356539356337386637386563353930633030313733376164613062346137313063613461643430333963366531323861383130373366313736666234613365396130656164303063386637386463663139333130363565633837663963386632396563333034346263636630653934663234373439313663646466303430626239343830383038303830383038303830383066383636396433633935623466383264383634643934306536393764333732646536346237333937353530623136353437333764633836373833336366646532623834366638343430313830613038376634386662646566633164663731343333313036633864383833393938396164663163363139633935343637383038393165616262616333633932616634613030393364396430396337306437653936303535303730656436393362383933333037616133386565303432316533316363616566343339386364323563313530',
                amount_proof_rlp:
                    '0x3078663864366638623138303830613034396662633063666435396435313334623438363636323366623634353232333262373338363663633137343437313237323932343635376435346335376666383038306130616663303534333637656138643130326536346163666331316361626435633632373936386438353665653261303932616131313030383830313831633862373830383061306136383263383038373964363962366639633733373161353837613337393030353766393435616633633130613639346530626661333836666134333632613638303830613038376532666234363139626665373866383265343232663334383333346361373664323930663832386335643435393631326265623663363163616134653064613031623536636330613562396231636533346539613134653839366561303030633833306264363433383735373364323338636265336661323464646661326333383038303830383065326130333235373561306539653539336330306639353966386339326631326462323836396333333935613362303530326430356532353136343436663731663835623031',
                block_number: '8286840',
                destination_proof_rlp:
                    '0x3078663864366638623138303830613034396662633063666435396435313334623438363636323366623634353232333262373338363663633137343437313237323932343635376435346335376666383038306130616663303534333637656138643130326536346163666331316361626435633632373936386438353665653261303932616131313030383830313831633862373830383061306136383263383038373964363962366639633733373161353837613337393030353766393435616633633130613639346530626661333836666134333632613638303830613038376532666234363139626665373866383265343232663334383333346361373664323930663832386335643435393631326265623663363163616134653064613031623536636330613562396231636533346539613134653839366561303030633833306264363433383735373364323338636265336661323464646661326333383038303830383065326130333235373561306539653539336330306639353966386339326631326462323836396333333935613362303530326430356532353136343436663731663835623031',
                nonce: '0x0000000000000000000000000000000000000000000000000000000000000001',
            });

            expect(result.toTransferParams()).toEqual({
                amount: 0,
                fee: undefined,
                gasLimit: undefined,
                mutez: false,
                parameter: {
                    entrypoint: 'wrap',
                    value: {
                        args: [
                            {
                                bytes: '307866393064313366393032313161306361323138333134323638373664656232363766623836366330343434313534346535636435326163663462366261323031656666383635343335393366376661303336666633386635353033323631396235393935393630373361323235626136383537303365646234333933336536346234336333353630356430356335386561303835316662306464383537656261653135356665306164303565636335613230636430663930356530363635393861396465363763313265663865386431663861306461323564336462373737393566356634656466396139653865346432653061623566313661663231643864616538333664616639303138623337663033643361306332383462303939333266373338633363396630643633633264303633623734346362393639326262363665626430323037333032333361376264656665623361306639346662643730616461366439613864343139643139396534656533636633346236343763613563653530643263366536646333353663303765646133663861306632636531343137613635363933356364613237383130306163343138356130666531346661663666313661626231363930323236346365633264626639343561306161646431376530306538633663613237363231336266626637386437376464643865386162313866633762363230633533303138346236633639613265386161303031636539623331383733616162323938653530306334346664346364393635316133383235623734653035363437626234323439333531303662373661613161306437303338636335323535623261396630333865303763323763656537666665353533666664646365356335636166313864316530636635396230353839343261303531333262613030626338333634326533313665383230383739376631316430383566313830626430366135623865363331333438613861396533303661366661303161633433393664353637363433396631336564633530356632333365613862666634333134336531376237643832616438336234323430303663383634373961303739376164653731366536663737653263643065373630666638336337643164643661386239366161383831303533366130326634613933336463346361623961303937313562303036623131623834613464666539643232653332626461326538633138653661613439313665373861306562633935316239616434316462333361303837343431396637373035323463396533613565666635376635343939383032396631623733623065626631336639646165633832633761323233663333643061303435326336353032643432343864373061646462393336343465643238646534343364396635613130376232356533666235313465656139323336376661613138306639303231316130383836386535363036653830373338626437626238393265626238643165303731663830303134633637303761366230313663363834653366333830613731616130393230346634373162326639616539373838393763333932626133633933396230333136373264396263613966356663306539623830373064303931333965316130616231373834326266353838333963386538313939633635343966323533613866336661306165623030666166303166316130333234666530326563376230346130643334323637393336656261393136636438626638383339383062633865643162623639313961633831623131393861383332613138343133386365333661376130363834303438303037373262636339303432393263376332616665363237393932623632393031613562343363303233623832346663353262636632383261316130356235613931316535303231613731333361383162643934393561333338373734636264646463373166653032343532303236626533373064653263663338646130383564306632386536323139626132363936666166356230366661613636343039633734303337613564373032336366616435336632633539343563653131396130626666346663643539336133326637333331393930623131333239336532333331616334353838636663383934626464663339633564626161643364616264306130656235366461396161313834613230336661386533306235636536393730333336383735636663653834656165373130313938313161303734643332343661636130636261333436303638636531653061613537383831633032663165313735356532366463316239386464653739303937316362366639663530346436623837306130316432343838326661346231616664643333653138313366353332613038303133613439323564373732383933346336353436303866633862616261333934396130303230343461383030666634353233313762373531613064616330626563303739633861393334633761353462303833313338356161393831646134313534656130613730333361303065353938353430636439326433393465326537393566323366343864363737393266353865306161343738373338316638383937303530316130643566343736346665373436393937353731663832333737643163613062616131363464366337306435643163633337326162383562356462636665666366306130393361353066316131373032323634636439303764326234653238343037636462643333623463373364343761653163346634383636343861316362316638636130656533626239623730316662333039643262313735663737653463653335353631373766333639376133333962373161323430323731626463666462336562343830663930323131613035353661656462396262333132663362663561636133623765346262653833616438373235643737303962643030653164653630636566343062646638393831613030303130666630613834363133393731363437336135336136333337313036613031316330313265633433313731373837623361316133656637653735323932613035343935376635353663393830316666613833343332623063656538393436356630336630303166376330333762623962303761303963646538616665653438613036666264346630653964663835373333616239616538393966393539386537326630643965303432373338623636366362633365386633643739393133343666613064313034303362326135653839313463343062393464306432383866663961363662373930326366323865346630343865636338666566643238306133373665613033666634336535626132613761383630313336633631343835646537623033356437613362383666633132356662663634643735336136303339323033613762613034643364643338316162303166643138383631303037306432623032323761346630376464393030323435653061613532373462316336363935343831376339613036356333323265643636343765616264613336373531353132383631323363613964313536396266366162613631343630623331306132653938653032353836613031656663373438663631616437396161633336343032653636633861376466303465613136656332626539396365666430653533356366623135393465343036613033653064666261366635306638646334663462306166373163323038613365666164653437353330343737643265363232653465376162373831643261393065613063623061303634366130663463666565626434656166646362343637613031616232643963306531376363343561613638633630336164363234333233323831613034356431663536633263376561343539656535373232636334326634643835356537656131626562386536623333623262646236356638323736666330303463613036343733616263373036393661363961633563346532396630306231346331373962323735646538613062346233623232336336386134646135306633356538613036343364393739653830306534313261383435333537336463643532326438636662363036303261393962343233323139386332346134393433666236353334613032616433303932626634313061653439306639373639653166623637383234656633626137363330353132616335373565316163326133646632633963663731613063363132323439313030643266653234653334623434646362643433326433663334363730376231663133623663646532623437383063393133636361346438383066393032313161303131626538623566623838666637616132386330396366616663626135613932363661386336616237343135666563323362653962303565323539313435343961306265356234326139656530636530326430663137613565343134376332663331623435366130316563353631376661623262393066666532373663623239323761303937393636333335383135656563633339326439363230316333373336633262653762356337376264356238303061306335653139643737303363626139373461306139343632383562633538393864666234663833663636346163636636323836346134653664653034373739333531366235633661333566326433386564343361306538373832376166656538616335303232336334313666363039306633636661366330393661643665636566346265363862373736303339633662396535656261303033666564613234346165373735346565643366343966303733613462363030326433613030626533333133373038336263653938306636393164333765636161303734626637363732636134386465313132633462656537643532343637303262363836316432316436653833653565613338653134376664313932626235633061306538623566363439366338626332613966346562306635656564613733616434343936643536316334336666643638356162396234626636623164386436633461306263663334383164333062373236653235393662353466306338393730303065303965316565636466336464333337613433663332396234313536666432336361306566383539323766373366623665613533343130326230623536356238306334646439353534323332323638653536663465663337353937353738643435366261303937373464653163613833383337623264356364663135663062346566356334626539346631643534346336303631653866383833333866346134326237303461306239646130396333386134303130343163653331376361626663323961633837633461313365613438363462306463363338316333396666393931343734613161306430653735643639663930356465383439303030366562336365306661666231666132623133363264306333393337666137366636633863613866383433616361303765336636396237616366333431323561303135326132623738346562333166653639333031336335366636346166326261666461313037643833373765393561303536623736666339623365663664393233396136386533386461646562646635336131383736303564346135323937386365386564356336643933313864383761306237363735366139636433396662613336346135373433316162363736633933643733323138386338363566356136333065306364343962373064313265613138306639303231316130313635623464336264343063666661363332373433313835313064336630363634313262383330383136333061656436633739393463373639376232663830396130346331346433353636386131623836633939333164366431356138393637643936306661663561653662393961643836396139383166353132303335623230356130323735393039383463346566376338363965666431313032653834613335396461383631383265373531333531343335323333623962326334353065353538636130376234643365353338373931346138623936373232623434323539313236636239313739623131396630383938616635626339656462633665313130383361616130646336356664626430623231376338393265663131666361663061613866643432353836366363343835353832333161333063356138646465646430346532656130326533336231326431336239343431356337343536323131623834666262666364326662663936623335646662643839376535343538663633663539373837316130623361316630376161323036393636626231323864333038616163363965396330346438303739313839653932333638376530306230393537323435376165376130373338313365306230653165303537663731366661333135643436353762356634316662646530303136653332613238636665333065623136653231613865656130383439376665383763616266333263363538323735626131363231373130313633656633613435323065313035313030343366323766336630383264396638616130363865303335303433313766623934653337353338613832613034303865643165613363313136306232326238313562646663363266303931636237343937646130613432326138353766636135383438393363333834346434346561343337363430306637346363663464396666623332666330363332373462613830373736396130616634393064313032353861306630376231303035663336336433623164393134363663343966633462323561306161626438623437633964316361613932356130636132313433353866336431333262313863613463666661373330663830623734666339366230383236643132666634663566656531373032323665393536386130663162626335313866373166353838313035616262383038343334333966396538613934373636343933393339356434366536653331646632396335386437666130353834336464386533316361653432616564363635623536376430303465393839386435323561353933386365336262386666633862393462363030303034636130303935383031336461633464663632616632366336316665633730623663326230303066623665313231613363353135363636343836356233306464343661633830663930316631613038663465623762356438323162396232343535316534313132386438613462336465363533616264386138643830373431643332666335643063643537643933613030633530363065666164353732333838636539616661663931343838653039306430653732363566356232613831396263346634356634343931333633656539613063343965613332316465353331316562343436376561373430313134396232393863383631353335633336383963656634306435303462656136633933616165613030663663303430386166376362366665346565333434396661653239333331636162666638636337663963376666643161383735653235656630336263623431613063393665666264333936333039326164353735353335666666363137346133313037653134656361653166626165343966303233303064656361363264323138613037623633323438633466303539616337653634353035663739353639636437613462383666343461363233353632383566613237326438343462363264643863613032386266646437343866393662303033343130666232306433356534383533386262313033363364316330633431643762383338346662333231356239343839613062373662643839386137323664303564306231663463393934383736656162396639316435346138663338366564383864396236346531353439333039653963613065313261396331666638663938376366353334666162373333653134393135656231313930313666303934626366396430326665633362643332336136386366613036363965633161383363333564356433663261633161653632626439373361666232383831633332646230373630626462323433613730333838356562663037613038306161393565386466666239613234663563313638316437653063616437623366646534316366396332623961336564363035353032343533313437376636613037663535363833633339343764623166376238323565326230643665653134373664613935333730633837396236343035636435313933613065666362333061613032333630653933363231303435663232633264643930323138616631613037393065656430636432366263383136653835386562306333356630383762376635383061303435303533393437623433396636326632623136663431653833656234633138373362396265376365353336326163663132326131353335623864356131303361303665653630366631653937303362386438363466373132636365386433373137396138653739383633373930336533313830363535346637326435353437353438306638353138303830383038303830383038306130356539356337386637386563353930633030313733376164613062346137313063613461643430333963366531323861383130373366313736666234613365396130656164303063386637386463663139333130363565633837663963386632396563333034346263636630653934663234373439313663646466303430626239343830383038303830383038303830383066383636396433633935623466383264383634643934306536393764333732646536346237333937353530623136353437333764633836373833336366646532623834366638343430313830613038376634386662646566633164663731343333313036633864383833393938396164663163363139633935343637383038393165616262616333633932616634613030393364396430396337306437653936303535303730656436393362383933333037616133386565303432316533316363616566343339386364323563313530',
                            },
                            {
                                args: [
                                    {
                                        bytes: '3078663864366638623138303830613034396662633063666435396435313334623438363636323366623634353232333262373338363663633137343437313237323932343635376435346335376666383038306130616663303534333637656138643130326536346163666331316361626435633632373936386438353665653261303932616131313030383830313831633862373830383061306136383263383038373964363962366639633733373161353837613337393030353766393435616633633130613639346530626661333836666134333632613638303830613038376532666234363139626665373866383265343232663334383333346361373664323930663832386335643435393631326265623663363163616134653064613031623536636330613562396231636533346539613134653839366561303030633833306264363433383735373364323338636265336661323464646661326333383038303830383065326130333235373561306539653539336330306639353966386339326631326462323836396333333935613362303530326430356532353136343436663731663835623031',
                                    },
                                    {
                                        args: [
                                            {
                                                int: '8286840',
                                            },
                                            {
                                                args: [
                                                    {
                                                        bytes: '3078663864366638623138303830613034396662633063666435396435313334623438363636323366623634353232333262373338363663633137343437313237323932343635376435346335376666383038306130616663303534333637656138643130326536346163666331316361626435633632373936386438353665653261303932616131313030383830313831633862373830383061306136383263383038373964363962366639633733373161353837613337393030353766393435616633633130613639346530626661333836666134333632613638303830613038376532666234363139626665373866383265343232663334383333346361373664323930663832386335643435393631326265623663363163616134653064613031623536636330613562396231636533346539613134653839366561303030633833306264363433383735373364323338636265336661323464646661326333383038303830383065326130333235373561306539653539336330306639353966386339326631326462323836396333333935613362303530326430356532353136343436663731663835623031',
                                                    },
                                                    {
                                                        bytes: '0000000000000000000000000000000000000000000000000000000000000001',
                                                    },
                                                ],
                                                prim: 'Pair',
                                            },
                                        ],
                                        prim: 'Pair',
                                    },
                                ],
                                prim: 'Pair',
                            },
                        ],
                        prim: 'Pair',
                    },
                },
                source: undefined,
                storageLimit: undefined,
                to: 'KT1PgvJ629MCN99k9EKYTaWZJXB9zd5bzvzd',
            });
        });

        it('unwrap', async () => {
            const result = await contract.unwrap({
                destination: '0x836F1aBf07dbdb7F262D0A71067DADC421Fe3Df0',
                amount: '10',
            });

            expect(result.toTransferParams()).toEqual({
                amount: 0,
                fee: undefined,
                gasLimit: undefined,
                mutez: false,
                parameter: {
                    entrypoint: 'unwrap',
                    value: {
                        args: [
                            {
                                int: '10',
                            },
                            {
                                bytes: '836F1aBf07dbdb7F262D0A71067DADC421Fe3Df0',
                            },
                        ],
                        prim: 'Pair',
                    },
                },
                source: undefined,
                storageLimit: undefined,
                to: 'KT1PgvJ629MCN99k9EKYTaWZJXB9zd5bzvzd',
            });
        });
    });
});

function http_handlers(url: string) {
    return [
        rest.get(`${url}/chains/main/blocks/head/protocols`, async (req, res, ctx) => {
            return res(
                ctx.json({
                    protocol: 'PtLimaPtLMwfNinJi9rCfDPWea8dFgTZ1MeJ9f1m2SRic6ayiwW',
                    next_protocol: 'PtLimaPtLMwfNinJi9rCfDPWea8dFgTZ1MeJ9f1m2SRic6ayiwW',
                }),
            );
        }),
        rest.get(`${url}/chains/main/chain_id`, async (req, res, ctx) => {
            return res(ctx.json('NetXnHfVqm9iesp'));
        }),
        rest.get(`${url}/chains/main/blocks/head~2/header`, async (req, res, ctx) => {
            return res(ctx.json(blockHeader));
        }),
        rest.get(
            `${url}/chains/main/blocks/head/context/contracts/${signer_address}/balance`,
            async (req, res, ctx) => {
                return res(ctx.json('324234324'));
            },
        ),
        rest.get(
            `${url}/chains/main/blocks/head/context/contracts/${signer_address}/manager_key`,
            async (req, res, ctx) => {
                return res(ctx.json('edpkuCoqz3RtxwpFfvmhrUwMv2yECB13hVTpvdFmHhbrEFCLogAb6Z'));
            },
        ),
        rest.get(`${url}/chains/main/blocks/head/context/constants`, async (req, res, ctx) => {
            return res(ctx.json(protocolConstants));
        }),
        rest.get(`${url}/chains/main/blocks/head/context/contracts/${signer_address}`, async (req, res, ctx) => {
            return res(
                ctx.json({
                    balance: '999999060',
                    counter: '13764685',
                }),
            );
        }),
        rest.get(`${url}/chains/main/blocks/head/context/contracts/${contractAddress}`, async (req, res, ctx) => {
            return res(ctx.json(contractResponse));
        }),
        rest.get(
            `${url}/chains/main/blocks/head/context/contracts/${contractAddress}/entrypoints`,
            async (req, res, ctx) => {
                return res(ctx.json(entrypoints));
            },
        ),
        rest.get(
            `${url}/chains/main/blocks/head/context/contracts/${contractAddress}/script`,
            async (req, res, ctx) => {
                return res(ctx.json(contractScriptResponse));
            },
        ),

        rest.post(`${url}/injection/operation`, async (req, res, ctx) => {
            return res(ctx.text('opLyi4ZBGDf3pb4A8eLkyouiFqNVgQ8X59ZStMesgYsHrQSLMGQ'));
        }),
        rest.post(`${url}/chains/main/blocks/head/helpers/preapply/operations`, async (req, res, ctx) => {
            return res(
                ctx.json([
                    {
                        contents: [
                            {
                                kind: 'transaction',
                                source: 'tz1YGTtd1hqGYTYKtcWSXYKSgCj5hvjaTPVd',
                                fee: '561',
                                counter: '13764686',
                                gas_limit: '2551',
                                storage_limit: '0',
                                amount: '0',
                                destination: 'KT1PgvJ629MCN99k9EKYTaWZJXB9zd5bzvzd',
                                parameters: {
                                    entrypoint: 'snapshot',
                                    value: {
                                        prim: 'Unit',
                                    },
                                },
                                metadata: {
                                    balance_updates: [
                                        {
                                            kind: 'contract',
                                            contract: 'tz1YGTtd1hqGYTYKtcWSXYKSgCj5hvjaTPVd',
                                            change: '-561',
                                            origin: 'block',
                                        },
                                        {
                                            kind: 'accumulator',
                                            category: 'block fees',
                                            change: '561',
                                            origin: 'block',
                                        },
                                    ],
                                    operation_result: {
                                        status: 'applied',
                                        storage: [
                                            {
                                                prim: 'Pair',
                                                args: [
                                                    {
                                                        bytes: '00006b82198cb179e8306c1bedd08f12dc863f328886',
                                                    },
                                                    {
                                                        prim: 'Pair',
                                                        args: [
                                                            {
                                                                int: '32',
                                                            },
                                                            {
                                                                int: '5',
                                                            },
                                                        ],
                                                    },
                                                ],
                                            },
                                            [
                                                [],
                                                {
                                                    bytes: '',
                                                },
                                                {
                                                    prim: 'Pair',
                                                    args: [
                                                        {
                                                            prim: 'Pair',
                                                            args: [
                                                                {
                                                                    int: '0',
                                                                },
                                                                {
                                                                    int: '0',
                                                                },
                                                            ],
                                                        },
                                                        {
                                                            bytes: '',
                                                        },
                                                    ],
                                                },
                                                [],
                                            ],
                                            {
                                                int: '7',
                                            },
                                            {
                                                int: '217639',
                                            },
                                            {
                                                int: '1667068',
                                            },
                                        ],
                                        consumed_milligas: '1450295',
                                        storage_size: '7954',
                                        lazy_storage_diff: [
                                            {
                                                kind: 'big_map',
                                                id: '217639',
                                                diff: {
                                                    action: 'update',
                                                    updates: [
                                                        {
                                                            key_hash:
                                                                'exprufunBN3FAVpZ21WXquoqiNyWB2PvYy1njkP4wHGtMexdKtcJEM',
                                                            key: {
                                                                int: '7',
                                                            },
                                                            value: {
                                                                int: '1667067',
                                                            },
                                                        },
                                                    ],
                                                },
                                            },
                                        ],
                                    },
                                    internal_operation_results: [
                                        {
                                            kind: 'event',
                                            source: 'KT1PgvJ629MCN99k9EKYTaWZJXB9zd5bzvzd',
                                            nonce: 0,
                                            type: {
                                                prim: 'pair',
                                                args: [
                                                    {
                                                        prim: 'nat',
                                                        annots: ['%level'],
                                                    },
                                                    {
                                                        prim: 'nat',
                                                        annots: ['%snapshot'],
                                                    },
                                                ],
                                            },
                                            tag: 'SNAPSHOT_FINALIZED',
                                            payload: {
                                                prim: 'Pair',
                                                args: [
                                                    {
                                                        int: '1667068',
                                                    },
                                                    {
                                                        int: '7',
                                                    },
                                                ],
                                            },
                                            result: {
                                                status: 'applied',
                                                consumed_milligas: '1000000',
                                            },
                                        },
                                    ],
                                },
                            },
                        ],
                        signature:
                            'edsigtiFyGJbLBBt1C6sn6Vg729kr6bWxAFTtWg2LwESbq9kLCfmoGYFW5xXuZTYQosqjKJEDDeB9ZWwhbpqNDjomqtvHSNV8F1',
                    },
                ]),
            );
        }),

        rest.post(`${url}/chains/main/blocks/head/helpers/scripts/run_operation`, async (req, res, ctx) => {
            return res(
                ctx.json({
                    contents: [
                        {
                            kind: 'transaction',
                            source: 'tz1YGTtd1hqGYTYKtcWSXYKSgCj5hvjaTPVd',
                            fee: '0',
                            counter: '13764686',
                            gas_limit: '1040000',
                            storage_limit: '60000',
                            amount: '0',
                            destination: 'KT1PgvJ629MCN99k9EKYTaWZJXB9zd5bzvzd',
                            parameters: {
                                entrypoint: 'snapshot',
                                value: {
                                    prim: 'Unit',
                                },
                            },
                            metadata: {
                                operation_result: {
                                    status: 'applied',
                                    storage: [
                                        {
                                            prim: 'Pair',
                                            args: [
                                                {
                                                    bytes: '00006b82198cb179e8306c1bedd08f12dc863f328886',
                                                },
                                                {
                                                    prim: 'Pair',
                                                    args: [
                                                        {
                                                            int: '32',
                                                        },
                                                        {
                                                            int: '5',
                                                        },
                                                    ],
                                                },
                                            ],
                                        },
                                        [
                                            [],
                                            {
                                                bytes: '',
                                            },
                                            {
                                                prim: 'Pair',
                                                args: [
                                                    {
                                                        prim: 'Pair',
                                                        args: [
                                                            {
                                                                int: '0',
                                                            },
                                                            {
                                                                int: '0',
                                                            },
                                                        ],
                                                    },
                                                    {
                                                        bytes: '',
                                                    },
                                                ],
                                            },
                                            [],
                                        ],
                                        {
                                            int: '7',
                                        },
                                        {
                                            int: '217639',
                                        },
                                        {
                                            int: '1667063',
                                        },
                                    ],
                                    consumed_milligas: '1450295',
                                    storage_size: '7954',
                                    lazy_storage_diff: [
                                        {
                                            kind: 'big_map',
                                            id: '217639',
                                            diff: {
                                                action: 'update',
                                                updates: [
                                                    {
                                                        key_hash:
                                                            'exprufunBN3FAVpZ21WXquoqiNyWB2PvYy1njkP4wHGtMexdKtcJEM',
                                                        key: {
                                                            int: '7',
                                                        },
                                                        value: {
                                                            int: '1667062',
                                                        },
                                                    },
                                                ],
                                            },
                                        },
                                    ],
                                },
                                internal_operation_results: [
                                    {
                                        kind: 'event',
                                        source: 'KT1PgvJ629MCN99k9EKYTaWZJXB9zd5bzvzd',
                                        nonce: 0,
                                        type: {
                                            prim: 'pair',
                                            args: [
                                                {
                                                    prim: 'nat',
                                                    annots: ['%level'],
                                                },
                                                {
                                                    prim: 'nat',
                                                    annots: ['%snapshot'],
                                                },
                                            ],
                                        },
                                        tag: 'SNAPSHOT_FINALIZED',
                                        payload: {
                                            prim: 'Pair',
                                            args: [
                                                {
                                                    int: '1667063',
                                                },
                                                {
                                                    int: '7',
                                                },
                                            ],
                                        },
                                        result: {
                                            status: 'applied',
                                            consumed_milligas: '1000000',
                                        },
                                    },
                                ],
                            },
                        },
                    ],
                    signature:
                        'edsigtkpiSSschcaCt9pUVrpNPf7TTcgvgDEDD6NCEHMy8NNQJCGnMfLZzYoQj74yLjo9wx6MPVV29CvVzgi7qEcEUok3k7AuMg',
                }),
            );
        }),
    ];
}
