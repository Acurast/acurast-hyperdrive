import smartpy as sp

from contracts.tezos.IBCF_Eth_Validator import (
    IBCF_Eth_Validator,
    Error,
    RLP_utils,
    Lambdas,
)
from contracts.tezos.libs.utils import RLP, Nat, Bytes

BLOCK_HEADER_STATE_ROOT_INDEX = 3
BLOCK_HEADER_LEVEL_INDEX = 8


class Helpers:
    @staticmethod
    def get_info_from_block_header(block_header):
        """
        Extract state root from block header, verifying block hash

        block_hash = sp.keccak(block_header)
        """
        nat_of_bytes_lambda = sp.compute(sp.build_lambda(Nat.of_bytes))
        rlp_to_list = sp.compute(RLP_utils.to_list())
        rlp_remove_offset = sp.compute(RLP_utils.remove_offset())

        header_fields = sp.compute(rlp_to_list(block_header))

        # Get state root hash
        state_root = rlp_remove_offset(header_fields[BLOCK_HEADER_STATE_ROOT_INDEX])
        # Get block level
        block_number = nat_of_bytes_lambda(
            rlp_remove_offset(header_fields[BLOCK_HEADER_LEVEL_INDEX])
        )

        sp.result(
            sp.record(
                state_root=state_root,
                block_number=block_number,
            )
        )


@sp.add_test(name="IBCF_Eth_Validator")
def test():
    admin = sp.test_account("admin")
    alice = sp.test_account("alice")
    bob = sp.test_account("bob")
    claus = sp.test_account("claus")

    scenario = sp.test_scenario()

    ibcf = IBCF_Eth_Validator()
    ibcf.update_initial_storage(
        config=sp.record(
            administrator=admin.address,
            validators=sp.set([alice.address, bob.address, claus.address]),
            minimum_endorsements=2,
            history_length=5,
            snapshot_interval=5,
        ),
        current_snapshot=0,
        state_root=sp.big_map(),
        history=sp.set(),
    )

    scenario += ibcf

    # Validate helper views
    nibbles_of_bytes_lambda = scenario.compute(
        sp.build_lambda(Lambdas.nibbles_of_bytes)
    )
    scenario.verify(
        nibbles_of_bytes_lambda(
            sp.record(
                bytes=sp.bytes("0x836F1aBf07dbdb7F262D0A71067DADC421Fe3Df0"), skip=2
            )
        )
        == sp.bytes(
            "0x060f010a0b0f00070d0b0d0b070f0206020d000a07010006070d0a0d0c0402010f0e030d0f00"
        )
    )
    extract_nibble_lambda = scenario.compute(sp.build_lambda(Lambdas.extract_nibble))
    scenario.verify(
        extract_nibble_lambda(
            sp.record(
                path=sp.bytes(
                    "0x6c2c8896c2375ca53a40019b1c64f2fb4cfbee5ff546cde64bf4bee12a4c0088"
                ),
                position=1,
            )
        )
        == 12
    )

    # Submit account proof for a given block (validator: alice)
    ibcf.submit_block_state_root(
        block_number=7179825,
        state_root=sp.build_lambda(Helpers.get_info_from_block_header)(
            sp.bytes(
                "0xf90206a04880ecb6195d09477157e40eb5a15390cea5baf2f4d109915bcbdd30defdd5e0a01dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d4934794b2930b35844a230f00e51431acae96fe543a0347a0707ef8cb8652a70d509aa815f54add98a301327d7715329d4061f5e3ddb4c2e3a0ec467e94e90ba8053ac3d279fc0794161e84f4c5aa328208bfa0717090c1952fa07e7014d6a03e20602d4ff5e78a930443062d084bcf37be4e97bf7140cbdfdea5b901001c560054585a1a6044ac08040000a00400080011c0530100010200020800006a08804105403402000c004012042000000a0840080408811c022c082c0ca8040001184800516160230485903c0a4084005a070400991010811350c41180002001c411040a3a2000020540001004002830004c2022049658010005001140100104240900900146004009021000400400088840d080430005140009834c0000308c8206b200008812008f0c0180011b800004400001200000100800449c848605028430100200102484850840089621244444006001a2004010001000348982a0900010840001015c00900000018d11a150000a601600980c488c80000c0092411187087b0d49f4256b836d8e31837a121d83796724845c59ec0d8573696e6733a0841e4ff411a6665ad429a8cdd62fbfb544a3a475b9cda839cbf7cb3f81dad9e98810210d940048eddb"
            )
        ).state_root,
    ).run(sender=alice.address)

    # Verify storage proof for an account state at a given block (No consensus yet)
    e = sp.catch_exception(
        ibcf.validate_storage_proof(
            sp.record(
                block_number=7179825,
                account=sp.bytes("0x9cc9bf39a84998089050a90087e597c26758685d"),
                account_proof_rlp=sp.bytes(
                    "0xf90d88f90211a0c8cd46af1b79ad42fa13a2f33da7bc1dbd2e5802fd416861f1fdc5a13e8940dda05bc496c81f8fcad9374386ce23cb05f12d0422dae3e84401870afb0f1beb4adaa0e235390a4551a62b1ac43a4a9be3c78f1e9ef04fe59cfcd087c72fccf0866e3aa0b4bb9cf76540eb61240b9c8a2d8fb0fdf2413544f13b177f5d2c69b6e61b1741a0a65176bed8f8f40eee1837776bb87683d0b2fa148ccc70e6d3da58df6761e813a02ad741a9e23d6ea154239a9e6a590800ed0e54b7baf83325f5a92e0b2db62b72a0d8ab9cecfc1e1d25e55031b9b31b10c9e8698ce4420bd921995c504932c91a21a01ec2e40343ae9dd8471f6ea9ffe48a4c99d42c664c05b0aa0a8c789b6bcd1342a08ad1a6dbc533492153df645f1ed30a7c4bc7327893e45634671e718ab53e69b1a08fa341768d72b9f310e2636225e0b9dbd906732d88eb3ccf786d9445c10511b5a05281ebf7637dc8e8d4b3fdd13a3587d48a7ea08d67035a09ec1fd2dd8fe62d7aa0681d05338c42c9c274eda6194d37bcd60630193b1fe4e21fd54ffda79ab436d7a0ebff770ac316f78cf27576a8e41e8d58599ed264fd68c2de1e13c9db02d2f156a0e056158ceadb4d6e97cf1e8406d311707f3860259413edd51c4ee170efa7fa1fa037497d736f3db69217cb3e72e04ea38faab08ed965caaa7701ddacb772bebacfa0ba76449bd47af7709f436294db9709983571648428c24cc8a4ff0d4fa3ef331880f90211a04c1573d31a649b166342b43381e8e47c0a2ad99dc5a5383917b69243f47073bea096b3a2b017f3351bb151d20ef8562dd08dc0c38cf291beb0d5a15c277798726ca0d34b6133fc44aeb8ee613c4d40d8b21df144f245c38908f9dd7fca75adf554c1a065e4fa744b40031dcb45a797ab998cf95fa2a2dca37dc0c09961e40cde9110d3a0a4b839236c148cb944e6a7ecd22b18ab23b28153bd5d100d1b5ed3392ddce0bda03e8be0ca57bfd9d6e7f69e3718592da3eff91940ca028104017252cf6c5031f1a07ba8d3fcecd43df88ca78b2dab753c9b4e1637b38ee1221ec731532ab2c4dc88a0e46aab7ee8d8ac4cb4a9040eaf6e777555067e83323d9ae80220127b4ffb3c40a00bfe0f6b4dc508fe880b21578741e9f61314c643d6e277c85e97534c6745e711a08fd2d3f729651038e6dd475d4d2029f312265fad65d855bf5fc636a8ddc8e910a098bba3a27066f10238dc0c7b82731320040cb63ca0ef34679d84a33acf98305ba0b2179a591fa45cb336e0965be12e6324ef54ebff27d4fbd0aa2527e3f03cd336a0ee114d413c735f572ec5f9b62e2640241909ca8539601e0bad7ad80bcbfd9ee3a0b4676801510fb9bc345fff7aa4ef857df379237a554c47e20009ea251b5f4022a0c0b99fb318bbac755d54f9c04848e27567d15964e9acc3f8f551c3efac499d79a0851302114fdcbe8f995cdc5526e756c206f34eeed821abb774925bd63202a59780f90211a04114b5f339b385f94c3ebaec9a39f7ab299c84f1c9615577008cfa34d46833cfa0891509cb86d182b78e38bbcbb7d56935fb49fd2d76f8c2835dac11f60642e6f3a01f33af279c8f72fe5905ff6abde54f42df733dd4d0b912dc749e84f2288be5d7a00dec13ec9f3ebb99348f9c2cf23da955609dee0cffda15f3b96509d835aef60ea0d207ae9d43f08b8ef4b6b312ee77eae3e6812b7923c164a89677b767b46ad06fa0919b1288c8bf767aaf8ca2ad205cb7415fe84eeafda0b83c089db8af8243ee0ca0ec5608754d2eaa9361ecdc3a5797d6149893eeb163d38f9d7262f9684449621fa0793bbd95653588c96d9d3ce0232b39d80dd0183e23b2ade4c54129eeb78091eea0bce0f33502ddd0dd2d557c0a7f4a4cc34df26248039f870296ca771bd2e0ba0ea0e703d943d47307d0c9b68504a691f5462727b393441aa5354f16d7c97c3a2acfa08652bf0edb8c57d65f85330aa59ea4d99f8b15409ae61da01de6f2d2429f5486a0e366b137c244e033720f72a3868046233e879d8ff69d62c8edd84920520e132ea05d0d64aab90b16eb9a30e99b903d8553f839a7df04230a77d7c55470bab36055a0c58dce64cf524460cc2264d3850e45a74b1c6bd1efcb574f51a482dabf88c58da0c71e861cac8b0a811a874c461df6f30d8516dfc5a7d7debae921c011c5a6e512a0bb70b02cd078729d3e5beb1cbd7c1aca78df91776db702d84e44dc01a3bef15d80f90211a0ff9f933de9900da961596607643224b45ea239d3478738e9dfb5bfb6ce835157a0f0fd47c84cbc75cbb246088bd8c3a9e0ff136e16449d3e873841999878801c7da07de8b4971586acc1262ecfbd46f999858b2d3f963c42609466dbe739e3f5f376a0d20606097e9076b24c845130bf6759f159ec2d3e95d75f215c2c435dad872430a014103161e9bbffea6afa58d5652a6152d27e77a6392cf79ae88911f2988ecc03a0a42a1df6c377ac100b114c4524b9e1dd7fd357811fc13da5fe30532bb4ca0f41a09ccdf76d0d76894e89ad962085f3a73bf3a9ba52d38e7cc4a5942ed2cd5ad573a0cefb669ec5d8fdd22d0e3ac31aa8d6a6ce6ce3bf6a6433d1ed8ab76f709d8b62a04eee36386e3ef435416559a27b374e684fa745fbc0142b2e31688691e3474322a072727b875115ab2049b8189291b61d0ab4119e21c389cfe7e50306e6023efa4da07bbbe14e56c22643cfc487fe3d07a0212d3ef14dbbef01b85b11d7a4f228d360a027ae43b03a73b682a4da899061ecf1fd1c0bc6c0b8421dbe1277d83a827ed2cca0b2b798dd42a60a3d35b86cfa6652d7c7030fc7a9d72d5ddd1ff1879978a211d5a09e3ecba335caf87706b52c80c20a10424ca703da335cae000d526c5c066e214ea00e79741831058d353c1026ae935f98e08cf979b61a45d46df712214ad9468deea09699ace2e29eb106d150fbdac22313ba326e72d0ead227dc6f60bb1393f2298480f90211a09e42e4d26a3ddf832fbd376055c19d99ee4309c91a7893e4bae526494b3e50f2a06168fabc77cfc3e1cd449b246eb311c223bf5456667e9af6de5e872ec3f7d1d5a07bf097d13c927e4dab5bebcda4d1bcdb290bbe8b42dec822768059b97d0148a4a0ff2fbc31c95c47b6f4a0b817f0ee2ece687cb1a6b918dbbd66e3502501b6d20fa0a848772c79e0733534ba77334b86d1c242a8d676f27dc993156b45a478e73880a01011dfed145677bef578c46d6d46a4e23c9b38e47246d46082990cbe6a9c02dda0dc83188546e3e96acbdcacda3a2bf54e6069fe10933c9c0a23403b8ce0935d0da07f62f2feb6d2ef09aa7b92284ff856f2cdebab33039838765174f7cb3ec9bb5ca00d4a262a059d17bc3f53182fef62f4dedcb13c4825c491640ab0ae4df71ab217a08eb84a6f051e4da23e779ed64c3ae650e59fdddc558cc6ec500e2b4f24d8523da041167ece41a040f26bb02a8009fd5512c27e29a2db71ec6b6c7ad7e621d81c77a0cd75570f97041719a5b6b2fbe9444c8fa5fa00e63fb200644537f7ff21547473a0253c9e9be058f010f3daa3eea825367cb9da21bcd5b39561dd6b597548bb1d51a037211e33ed3055c97f4df78d9a79dd5835c828f725103603a37e7b4cb14aca60a007e29805d8852d9a415290615f5291df823c9930dfb458a6520f99cd0036d870a04508db4e005c9feb3ecdd7dca11009256cbfab21edeb93def074e4b41dac162b80f901d1a0e8e020afe8aacb0f9bbadd534aa13abb0cb4de8c7e2ca554d6df7c2b507fed0a80a0da2d2ab7c069825fcb422f2a14aa072d14c76869104f1500f3f83e871c27417ea0a0b23808356f66db7097c098b87c6493d4c7111b45980524a412c8224a87e350a01a10f3f451eed17dc2cb98799fef6f46179c6742446dd3e73aacc339af81b4c1a02d50de9845254bed1fb80a1d8ed909c3ecd3df0544893fb042f9640c1d934ca5a07b3b50b860c3c7f8787c8d046c4e60f74535a1c2ec90c0f7dfc861041e28dc63a0ad46d416aa111d6cce7a5e5941354fab6773fb47b41468662855872710a98967a011a4370e53456f9ef5b277c6892acb3d05d5b5de266491d86fe1d401394fbf02a01f80eb207cef5c6103711e7b156d055015728dc6176bcd757754ba633d948782a01d34211de3dd11f5fd6fb1948ed6ca922f81c5caddacf14059bc09cec4ca4b99a08213883ca57a3353d4a516c69cd022c665b51599cfebf6c0e4a345a404eb4d7980a07f4a356bbf7d64d7e7883636090d56123784e790777e20d0febcc9a36d0471cca092956576f5de3738de2d061e244eabb2e14fc7c7922b3766e29ea9fe50d2158da02ddd89bad44e0c8384cf0780f00a07eb3a8df167cffda1c1a6f8ed3b0429fa9b80f8718080808080808080a001bcc1bfa4306681ba90951d2547e6b9c6aeaad81f1cb4394f696e4f1b941f7ca037fb984c6c1e14e4e1d4e98d6d45cabe83f878f3a36d9435a5cbce1b3634916c80a0e6b7500ebd2b6b90e2c0c2208e5e7a85e8bd4b7392844d81864ddd961db07d948080808080e216a0e886040251f67ebad1399818dd16d3879e7b4ce836ccdd16562e640bd7462c47f85180a0d12e19add3399af92b890ec9eeb5c9b9152f093d20600fe587e6472314a37afe80808080808080808080a0315279f9bc0eb2ac0827d79d4b2ede9acc71c485fd3bf993c783e00c5b76fc4e80808080f8659c32375ca53a40019b1c64f2fb4cfbee5ff546cde64bf4bee12a4c0088b846f8440180a0c14953a64f69632619636fbdf327e883436b9fd1b1025220e50fb70ab7d2e2a8a0f7cf6232b8d655b92268b3565325e8897f2f82d65a4eaaf4e78fcef04e8fee6a"
                ),
                storage_slot=sp.bytes(
                    "0x0000000000000000000000000000000000000000000000000000000000000000"
                ),
                storage_proof_rlp=sp.bytes(
                    "0xf879f8518080a036bb5f2fd6f99b186600638644e2f0396989955e201672f7e81e8c8f466ed5b98080808080808080808080a0f70bd5b82fa5222804070e8400da42b4ae39eb527a42f19106acf68ea58a4eb38080e5a0390decd9548b62a8d60345a988386fc84ba6bc95484008f6362f93160ef3e563838204d2"
                ),
            )
        ),
        t=sp.TString,
    )
    scenario.verify(e == sp.some(Error.NO_CONSENSUS_FOR_STATE))

    # Submit account proof for a given block (validator: bob)
    ibcf.submit_block_state_root(
        block_number=7179825,
        state_root=sp.build_lambda(Helpers.get_info_from_block_header)(
            sp.bytes(
                "0xf90206a04880ecb6195d09477157e40eb5a15390cea5baf2f4d109915bcbdd30defdd5e0a01dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d4934794b2930b35844a230f00e51431acae96fe543a0347a0707ef8cb8652a70d509aa815f54add98a301327d7715329d4061f5e3ddb4c2e3a0ec467e94e90ba8053ac3d279fc0794161e84f4c5aa328208bfa0717090c1952fa07e7014d6a03e20602d4ff5e78a930443062d084bcf37be4e97bf7140cbdfdea5b901001c560054585a1a6044ac08040000a00400080011c0530100010200020800006a08804105403402000c004012042000000a0840080408811c022c082c0ca8040001184800516160230485903c0a4084005a070400991010811350c41180002001c411040a3a2000020540001004002830004c2022049658010005001140100104240900900146004009021000400400088840d080430005140009834c0000308c8206b200008812008f0c0180011b800004400001200000100800449c848605028430100200102484850840089621244444006001a2004010001000348982a0900010840001015c00900000018d11a150000a601600980c488c80000c0092411187087b0d49f4256b836d8e31837a121d83796724845c59ec0d8573696e6733a0841e4ff411a6665ad429a8cdd62fbfb544a3a475b9cda839cbf7cb3f81dad9e98810210d940048eddb"
            )
        ).state_root,
    ).run(sender=bob.address)

    # Verify storage proof for an account state at a given block (Consensus reached)
    scenario.verify(
        ibcf.validate_storage_proof(
            sp.record(
                block_number=7179825,
                account=sp.bytes("0x9cc9bf39a84998089050a90087e597c26758685d"),
                account_proof_rlp=sp.bytes(
                    "0xf90d88f90211a0c8cd46af1b79ad42fa13a2f33da7bc1dbd2e5802fd416861f1fdc5a13e8940dda05bc496c81f8fcad9374386ce23cb05f12d0422dae3e84401870afb0f1beb4adaa0e235390a4551a62b1ac43a4a9be3c78f1e9ef04fe59cfcd087c72fccf0866e3aa0b4bb9cf76540eb61240b9c8a2d8fb0fdf2413544f13b177f5d2c69b6e61b1741a0a65176bed8f8f40eee1837776bb87683d0b2fa148ccc70e6d3da58df6761e813a02ad741a9e23d6ea154239a9e6a590800ed0e54b7baf83325f5a92e0b2db62b72a0d8ab9cecfc1e1d25e55031b9b31b10c9e8698ce4420bd921995c504932c91a21a01ec2e40343ae9dd8471f6ea9ffe48a4c99d42c664c05b0aa0a8c789b6bcd1342a08ad1a6dbc533492153df645f1ed30a7c4bc7327893e45634671e718ab53e69b1a08fa341768d72b9f310e2636225e0b9dbd906732d88eb3ccf786d9445c10511b5a05281ebf7637dc8e8d4b3fdd13a3587d48a7ea08d67035a09ec1fd2dd8fe62d7aa0681d05338c42c9c274eda6194d37bcd60630193b1fe4e21fd54ffda79ab436d7a0ebff770ac316f78cf27576a8e41e8d58599ed264fd68c2de1e13c9db02d2f156a0e056158ceadb4d6e97cf1e8406d311707f3860259413edd51c4ee170efa7fa1fa037497d736f3db69217cb3e72e04ea38faab08ed965caaa7701ddacb772bebacfa0ba76449bd47af7709f436294db9709983571648428c24cc8a4ff0d4fa3ef331880f90211a04c1573d31a649b166342b43381e8e47c0a2ad99dc5a5383917b69243f47073bea096b3a2b017f3351bb151d20ef8562dd08dc0c38cf291beb0d5a15c277798726ca0d34b6133fc44aeb8ee613c4d40d8b21df144f245c38908f9dd7fca75adf554c1a065e4fa744b40031dcb45a797ab998cf95fa2a2dca37dc0c09961e40cde9110d3a0a4b839236c148cb944e6a7ecd22b18ab23b28153bd5d100d1b5ed3392ddce0bda03e8be0ca57bfd9d6e7f69e3718592da3eff91940ca028104017252cf6c5031f1a07ba8d3fcecd43df88ca78b2dab753c9b4e1637b38ee1221ec731532ab2c4dc88a0e46aab7ee8d8ac4cb4a9040eaf6e777555067e83323d9ae80220127b4ffb3c40a00bfe0f6b4dc508fe880b21578741e9f61314c643d6e277c85e97534c6745e711a08fd2d3f729651038e6dd475d4d2029f312265fad65d855bf5fc636a8ddc8e910a098bba3a27066f10238dc0c7b82731320040cb63ca0ef34679d84a33acf98305ba0b2179a591fa45cb336e0965be12e6324ef54ebff27d4fbd0aa2527e3f03cd336a0ee114d413c735f572ec5f9b62e2640241909ca8539601e0bad7ad80bcbfd9ee3a0b4676801510fb9bc345fff7aa4ef857df379237a554c47e20009ea251b5f4022a0c0b99fb318bbac755d54f9c04848e27567d15964e9acc3f8f551c3efac499d79a0851302114fdcbe8f995cdc5526e756c206f34eeed821abb774925bd63202a59780f90211a04114b5f339b385f94c3ebaec9a39f7ab299c84f1c9615577008cfa34d46833cfa0891509cb86d182b78e38bbcbb7d56935fb49fd2d76f8c2835dac11f60642e6f3a01f33af279c8f72fe5905ff6abde54f42df733dd4d0b912dc749e84f2288be5d7a00dec13ec9f3ebb99348f9c2cf23da955609dee0cffda15f3b96509d835aef60ea0d207ae9d43f08b8ef4b6b312ee77eae3e6812b7923c164a89677b767b46ad06fa0919b1288c8bf767aaf8ca2ad205cb7415fe84eeafda0b83c089db8af8243ee0ca0ec5608754d2eaa9361ecdc3a5797d6149893eeb163d38f9d7262f9684449621fa0793bbd95653588c96d9d3ce0232b39d80dd0183e23b2ade4c54129eeb78091eea0bce0f33502ddd0dd2d557c0a7f4a4cc34df26248039f870296ca771bd2e0ba0ea0e703d943d47307d0c9b68504a691f5462727b393441aa5354f16d7c97c3a2acfa08652bf0edb8c57d65f85330aa59ea4d99f8b15409ae61da01de6f2d2429f5486a0e366b137c244e033720f72a3868046233e879d8ff69d62c8edd84920520e132ea05d0d64aab90b16eb9a30e99b903d8553f839a7df04230a77d7c55470bab36055a0c58dce64cf524460cc2264d3850e45a74b1c6bd1efcb574f51a482dabf88c58da0c71e861cac8b0a811a874c461df6f30d8516dfc5a7d7debae921c011c5a6e512a0bb70b02cd078729d3e5beb1cbd7c1aca78df91776db702d84e44dc01a3bef15d80f90211a0ff9f933de9900da961596607643224b45ea239d3478738e9dfb5bfb6ce835157a0f0fd47c84cbc75cbb246088bd8c3a9e0ff136e16449d3e873841999878801c7da07de8b4971586acc1262ecfbd46f999858b2d3f963c42609466dbe739e3f5f376a0d20606097e9076b24c845130bf6759f159ec2d3e95d75f215c2c435dad872430a014103161e9bbffea6afa58d5652a6152d27e77a6392cf79ae88911f2988ecc03a0a42a1df6c377ac100b114c4524b9e1dd7fd357811fc13da5fe30532bb4ca0f41a09ccdf76d0d76894e89ad962085f3a73bf3a9ba52d38e7cc4a5942ed2cd5ad573a0cefb669ec5d8fdd22d0e3ac31aa8d6a6ce6ce3bf6a6433d1ed8ab76f709d8b62a04eee36386e3ef435416559a27b374e684fa745fbc0142b2e31688691e3474322a072727b875115ab2049b8189291b61d0ab4119e21c389cfe7e50306e6023efa4da07bbbe14e56c22643cfc487fe3d07a0212d3ef14dbbef01b85b11d7a4f228d360a027ae43b03a73b682a4da899061ecf1fd1c0bc6c0b8421dbe1277d83a827ed2cca0b2b798dd42a60a3d35b86cfa6652d7c7030fc7a9d72d5ddd1ff1879978a211d5a09e3ecba335caf87706b52c80c20a10424ca703da335cae000d526c5c066e214ea00e79741831058d353c1026ae935f98e08cf979b61a45d46df712214ad9468deea09699ace2e29eb106d150fbdac22313ba326e72d0ead227dc6f60bb1393f2298480f90211a09e42e4d26a3ddf832fbd376055c19d99ee4309c91a7893e4bae526494b3e50f2a06168fabc77cfc3e1cd449b246eb311c223bf5456667e9af6de5e872ec3f7d1d5a07bf097d13c927e4dab5bebcda4d1bcdb290bbe8b42dec822768059b97d0148a4a0ff2fbc31c95c47b6f4a0b817f0ee2ece687cb1a6b918dbbd66e3502501b6d20fa0a848772c79e0733534ba77334b86d1c242a8d676f27dc993156b45a478e73880a01011dfed145677bef578c46d6d46a4e23c9b38e47246d46082990cbe6a9c02dda0dc83188546e3e96acbdcacda3a2bf54e6069fe10933c9c0a23403b8ce0935d0da07f62f2feb6d2ef09aa7b92284ff856f2cdebab33039838765174f7cb3ec9bb5ca00d4a262a059d17bc3f53182fef62f4dedcb13c4825c491640ab0ae4df71ab217a08eb84a6f051e4da23e779ed64c3ae650e59fdddc558cc6ec500e2b4f24d8523da041167ece41a040f26bb02a8009fd5512c27e29a2db71ec6b6c7ad7e621d81c77a0cd75570f97041719a5b6b2fbe9444c8fa5fa00e63fb200644537f7ff21547473a0253c9e9be058f010f3daa3eea825367cb9da21bcd5b39561dd6b597548bb1d51a037211e33ed3055c97f4df78d9a79dd5835c828f725103603a37e7b4cb14aca60a007e29805d8852d9a415290615f5291df823c9930dfb458a6520f99cd0036d870a04508db4e005c9feb3ecdd7dca11009256cbfab21edeb93def074e4b41dac162b80f901d1a0e8e020afe8aacb0f9bbadd534aa13abb0cb4de8c7e2ca554d6df7c2b507fed0a80a0da2d2ab7c069825fcb422f2a14aa072d14c76869104f1500f3f83e871c27417ea0a0b23808356f66db7097c098b87c6493d4c7111b45980524a412c8224a87e350a01a10f3f451eed17dc2cb98799fef6f46179c6742446dd3e73aacc339af81b4c1a02d50de9845254bed1fb80a1d8ed909c3ecd3df0544893fb042f9640c1d934ca5a07b3b50b860c3c7f8787c8d046c4e60f74535a1c2ec90c0f7dfc861041e28dc63a0ad46d416aa111d6cce7a5e5941354fab6773fb47b41468662855872710a98967a011a4370e53456f9ef5b277c6892acb3d05d5b5de266491d86fe1d401394fbf02a01f80eb207cef5c6103711e7b156d055015728dc6176bcd757754ba633d948782a01d34211de3dd11f5fd6fb1948ed6ca922f81c5caddacf14059bc09cec4ca4b99a08213883ca57a3353d4a516c69cd022c665b51599cfebf6c0e4a345a404eb4d7980a07f4a356bbf7d64d7e7883636090d56123784e790777e20d0febcc9a36d0471cca092956576f5de3738de2d061e244eabb2e14fc7c7922b3766e29ea9fe50d2158da02ddd89bad44e0c8384cf0780f00a07eb3a8df167cffda1c1a6f8ed3b0429fa9b80f8718080808080808080a001bcc1bfa4306681ba90951d2547e6b9c6aeaad81f1cb4394f696e4f1b941f7ca037fb984c6c1e14e4e1d4e98d6d45cabe83f878f3a36d9435a5cbce1b3634916c80a0e6b7500ebd2b6b90e2c0c2208e5e7a85e8bd4b7392844d81864ddd961db07d948080808080e216a0e886040251f67ebad1399818dd16d3879e7b4ce836ccdd16562e640bd7462c47f85180a0d12e19add3399af92b890ec9eeb5c9b9152f093d20600fe587e6472314a37afe80808080808080808080a0315279f9bc0eb2ac0827d79d4b2ede9acc71c485fd3bf993c783e00c5b76fc4e80808080f8659c32375ca53a40019b1c64f2fb4cfbee5ff546cde64bf4bee12a4c0088b846f8440180a0c14953a64f69632619636fbdf327e883436b9fd1b1025220e50fb70ab7d2e2a8a0f7cf6232b8d655b92268b3565325e8897f2f82d65a4eaaf4e78fcef04e8fee6a"
                ),
                storage_slot=sp.bytes(
                    "0x0000000000000000000000000000000000000000000000000000000000000000"
                ),
                storage_proof_rlp=sp.bytes(
                    "0xf879f8518080a036bb5f2fd6f99b186600638644e2f0396989955e201672f7e81e8c8f466ed5b98080808080808080808080a0f70bd5b82fa5222804070e8400da42b4ae39eb527a42f19106acf68ea58a4eb38080e5a0390decd9548b62a8d60345a988386fc84ba6bc95484008f6362f93160ef3e563838204d2"
                ),
            )
        )
        == sp.bytes("0x8204d2")
    )

    # Try proof after london fork
    ibcf.submit_block_state_root(
        block_number=7179830,
        state_root=sp.build_lambda(Helpers.get_info_from_block_header)(
            sp.bytes(
                "0xf9025ea04762fb29a496dd715306c4b3f1f7553da59db3b54763b4c1a6081bb71337a260a01dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347940000000000000000000000000000000000000000a0c1df38d9738220e530be6b2e128a35f11b0464815bf50ab038ef54fc27d10260a0ec729fdccaae057dc46935a612c9aa463fa9576635ed1d12fc3ca4c5514730eca0d857e9f3f6907e64d4af16006bf89698e2888e4efc1c95b057db70b5396d8492b9010000080020000000004020009280000000901502402010008009c0800008200009008810002101222261221021c000000a10400000020000010048400c0964022005014216902000a10202008811016000000184400416800808060104000020000008100702020204000000a812004a000000382040100000840080500002144c0000800200110a00084008010000000200a010000000080004a04800800410081a00c00000008360820030200000c00d140120805108001040214030840430418048320a000000280080000408a0400400001000848000401880100000006d000c10110040008910084100011008010204120000080180024000000000c0108002836ff0458401c9c36483837add8462e99460b861d883010a16846765746888676f312e31382e34856c696e7578000000000000006e0c462c16b5a65fc27cdd3e02a3f5248e9aff00f849c621e14dc40a4e3d5bb038136ab4fc436ebf9b8c63416873747c24b86baf02b76d547403ed80c159169301a000000000000000000000000000000000000000000000000000000000000000008800000000000000000a"
            )
        ).state_root,
    ).run(sender=alice.address)

    # Submit account proof for a given block (validator: bob)
    ibcf.submit_block_state_root(
        block_number=7179830,
        state_root=sp.build_lambda(Helpers.get_info_from_block_header)(
            sp.bytes(
                "0xf9025ea04762fb29a496dd715306c4b3f1f7553da59db3b54763b4c1a6081bb71337a260a01dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347940000000000000000000000000000000000000000a0c1df38d9738220e530be6b2e128a35f11b0464815bf50ab038ef54fc27d10260a0ec729fdccaae057dc46935a612c9aa463fa9576635ed1d12fc3ca4c5514730eca0d857e9f3f6907e64d4af16006bf89698e2888e4efc1c95b057db70b5396d8492b9010000080020000000004020009280000000901502402010008009c0800008200009008810002101222261221021c000000a10400000020000010048400c0964022005014216902000a10202008811016000000184400416800808060104000020000008100702020204000000a812004a000000382040100000840080500002144c0000800200110a00084008010000000200a010000000080004a04800800410081a00c00000008360820030200000c00d140120805108001040214030840430418048320a000000280080000408a0400400001000848000401880100000006d000c10110040008910084100011008010204120000080180024000000000c0108002836ff0458401c9c36483837add8462e99460b861d883010a16846765746888676f312e31382e34856c696e7578000000000000006e0c462c16b5a65fc27cdd3e02a3f5248e9aff00f849c621e14dc40a4e3d5bb038136ab4fc436ebf9b8c63416873747c24b86baf02b76d547403ed80c159169301a000000000000000000000000000000000000000000000000000000000000000008800000000000000000a"
            )
        ).state_root,
    ).run(sender=bob.address)

    scenario.show(
        ibcf.validate_storage_proof(
            sp.record(
                block_number=7179830,
                account=sp.bytes("0x5e927DD6cAbAD62f07E88aAC66387413e8d7D86F"),
                account_proof_rlp=sp.bytes(
                    "0xf90c12f90211a094b321ef9083b9599d64a9749d40fd4518097992da14bc622a879ca5bdb2a6f2a0e347a7569cdcbb901037140b06bbd546f23c5033fc1065e73ace52b90cf818eaa02b855528b285213217c8fd0342a69af848099851df5a6f2d934a1be9d6e24069a0b020a3422c219e14e9d53f0363fbd333dd4b2caa48f5fecc0ff96b176de3cab9a000348b79bb0a8a903e448ef28895f5a76394640b29fa9c95f6d0bff1f7426fdea0c51b3523e5eb2fd6cdd4f404eb1d5043d0c549032c82e4aa7250615347da0047a089a2462a627f3510ecc7dd0c98f79c9a8e13d52e4d759f869e931431db4c4c77a0368546fc74d92ea1bf3c29a35973db15443fcf779eee5ecdd4b654839a6ef17fa019811e41028d7832dcd75bd452025c4b85db24f41cc841af74d8f40bb6195e04a0805cda4670c4a490e65d4b42aa8492fd0ed2460abd8577380e66db9c11dc08eda065f1dfae53259c55c1ec67cc9249714edac68265c1cdc53f8d56dcec20b3c815a0774e18fc05c5dad36f9f434545e9df28b52ae9920c254bb76f4f75dbd24c2cc1a04b994b16cbb447fb50616a4c2fe35fc2d45ac4f69c57b24a7998763fe9dd65c8a043b52bd6a8d8b410c6c8f6dc22b3192a9af20be007751c3c83d5503a927b69a9a0ce10e5f20b6c3c49c7817de1153d5465121465cd1af14144d0771a5a46a5703fa029443032676149077152f45e1ae5c035081b99dc5a1b1a2412a976a42626140b80f90211a0551ded0566177e9d29f5d63ba12cb4a034fd5798a9248ac10b38f24363464d99a00ee2de09fe9ef140f65390a2219e0307748b35862030bd0f5f152f0bc06f8f2ba02129cd88c241ae6c279199c0b9dbab4f9b82fed99bfd4b991a319fd94e0fa4dea008a2fc516aef0d2f28ae9c028937e23810df26af2fbc4071b4935c8801d7750fa0007ae72785c88ee8d26a963701908777eec907c3355c6df5d655ca0ebe359213a027a87f0d56cb51e535b0a710fe34c393e085a3f908a0cab10d5027979a649322a09c8c3e099db425f65d98144bd01fdcbeb9987de8f5b50c7375731f0efdf32e39a00dc578638a7b1d1ffeadef4636fbf40e63a27bd80231fdacc64a7a56bbc69391a069687a58fe115f1e788643bec6333ac09bf00914541696bb1f12e6580e2f005ea0a7ca49f9ce07891a63ff9d10e106304a411c9f0bd25df5e7735b5e52c81bf52ea052b547532518cd6c84fe1e8e3e67d5a7666a6a9c415cb177735debce9a8827fba082caf502eec7cc65e7e56bfeff6789c8aa1bdb12eeaae96881a1487a5acc6296a0fcd7704033c8021473c4d1ffb4f5874fd736c8826add277df23e9df7b1de905ca0657b6bf0eea226247d635bcbca6568451e0ea66b804c4549db1e414be2a7b8d6a05faf76caff1751053203c8fdb756a0a76c3a27cb0668424eef805c9804833fc0a0d6be9c88968b550dc71c64789ee67a3078f9f678c9b0a7a3b27c5145ce6f68a980f90211a0121bed5c84acfd39696156034f5189351ef19c6cd7db7c4aab9c9c5629af016ca0a47bebd6f7a3ba2fd56c05a39cd38545f723521cb87c13c180f3dffbd5632fdea0b3f385fb742d57d8862902bf2ec73d1e59792f3a4a04369c610baed6c0292243a02cb89ebcb4a614c39fcb05f7a990e395de03667245ad9a67ad96c03b10b13bc1a0392efde23a639e07063cac789dee1107dff364e8544b7fb9e085bbc4f2136524a08c90c3b86e67826d15e323f408a3b105b41491de508a46e1e0cb45b91872629fa01b525ecad0e6f74073d8fe68aa08d582b8246b300351f15003525c65081e1c06a0f42910d3d15b45f9d393bc655c5650ef349a0253ccd456fc33369fab873101b3a04f310d0c2c68128211ba725a10bc6a992bb27d5614d882275017f8ff12810928a0e086eabbbadeda50726e723e1b9ac62097843f3004641fa65dbff9eb19002109a01a5bf4670ad410709c7e56c4cc04fd0d06472565d19966b4c15affab3b4a67d5a0e790745fd9c4abe986b3602c736eaf54a796c33488ca5c7c9c5ff02f0390d477a0389d13f5bc312cdff1607835467d331f3e815d79cf4057931260112ce4415671a028312da3fbcd360e7ec68acee2633f21f1c0d9a7730695ac9a3a6393e96b7763a09b84c47247384368059bbf886f80aeafc74a3fd150583e0f6d445bf48051664aa0070f2812dfc258108343956a835d6a41f1a08a4b031e95e39f71647c5fa0107380f90211a06da81cb4aceafe376e7501ad02e33d13b4f5ac3e9cfaeb80458ae96c43a3928ea042e28500e5f459e9580202e708959ce9cf54f0994722afabe3fe7ad327be1775a0d0f3bdecd8940e24c2cf258edd2fb314a1849a1a2d8e38e3950e1b27059cb9f5a08d3cf2829b484d21dae15fc5cc6211c40f190652658196ebf9c690871b05d974a05b25c3b0dc14f87e4592f8b9191335d8f9e4689e981c816869de69a34af76960a01ca2a30559cbb76604ae03e15f9c05f5fe3068161ca43760f57b9d6e6c93be72a0ec0142cca6bed95fd9254463ad127e1e4a4d9fe2480fca2be29a8fd1c3c1a267a07080a63a99a09f2170f813db30bb7bf39b868a9803f7488976a75e5aa49171cba06759ba1f4ebe786d8e0cfdc980613d175f998ee71a0f762a47fa94b8cb9d5f63a001ff8dce02620ef1a057226e36debe701b7df0d52321476a74901e25708b1e87a0a7f0e8a1ff71769d4494d26a1764d520dcc2278fed567c86116a1649b748048ea03d86372739469324bd77eef49feb39bb4d572838ab84f0246eddf1fa606fe812a0cf10be3fdbc28f6c3b03d90c5c7fee389ada9b0eb107c255aff538bdc637e8bea0cbc45f058f712e06a9cb5b350fac8003d1d4f7eceeb42c8f0a94c1769b59b8f2a026d140911aa9d7433addfbcb8f51fe7960f06ec5e62e7e31b61c5cff954e7fada070896b90512bc893f7848e2082e611215bb511fa808d39d83c4d88cfe7fd132080f90211a05b77e5114425b02f4d7eb2a9a61ff65d75985c3d9ca1ae0315de71b62e10e223a073675187583289866d4367804fbc439ad9aa07d16bf2dae797fbd68791749072a0060f61d3e9baa4993c8cab3db255033d69467f979c50a23f6b59631fafdc846aa0db934e324856d8eb3710a59a32fe3f1c4e08b43a3af5620f6ad580ec0566be41a0cf4cd05f1d1e4f84e5d616e03ca98f6544622cf5dc347aa32e059163ed804a8aa0df790be216e9ed462ab65971fe575a5249c4709cdf39f0f630ac2b774854894aa01106dfc5286f88cd20609fa92a03314ef70edb89a67b55b41e600e8af3309b0ca0bcb4128d6b201d97939ad7a70ab7d5ca7c5e59f560ca474b7c17d61f85dbf1bba0549ce2ace87fbf96f7d6c5f49dd171d7f4b9d2f64cb197421bbdd605e0101e74a004c04b46b6e2c0c6ca4879e8b2cf7d1eedb3d7f6fec30e0db57af41b78cc564ea015cd979d201b933f2ce1287643e554d96e82c775d03e6e879a6e9bee25034288a0875537c33dec58697c69bc01258ba9e2219fa27257f0be6f00b4c88ce4d6b33fa02af9073435ba98aa249ac49dcc9dab15f800aa421709767ed78ea21ee706a853a0d8bc70f49d79d4893a358a1eb3a8adcff27ff2dde856b1aa80779b5116a11e94a06bc16da727b6dd96be7e4383490b843c3d9036ac7e8468735ea59d97fb050f60a0157077e13d16483b5abcef000c9bc45206ed19f8a1823ca58949db193e75b93180f8f1a073d9ae047c1241ceb1a5b8fbc33c4072a4352d66ca7758c6bbfbf769bc9fb396a0bf4c567d7f790437be8d8f09eeea8abdefb3fe7cd6f524fa626f8067d32a8dea80a0fe33792f0a836fbcc8aa77cfdbdb85acf5de0199fa19fd919316f9d9caf7fcc28080a08b2c18b53d2d372f8139c0b41391bb7498d8c93c84b84e0659b0fc285cf8bcb18080808080a004b0bb7fe194c8f0cd612098d6375e54aa85124aa682a0ed48d5f418da471ab580a093cd3c181adde3461912881ae1f6140d0dc66be6210bcc735f1785e1c038f545a0c6c0275737e1c277f595045a2740d315de73f1361c36061922aa1757d0e5e25b80f85180808080808080a0925e31abdbeac9c3902de070c4bf1b2724f26dac1d87e6ae1dabd121620c9b43808080808080a03e511d3836d0a3ed3e4eeb121032dcbe378869672d9e2d67b945b787be53f66e8080f8669d3c54960483caaa33913aaff1d80757ffc8f77fb44b622a4da4b332081cb846f8440180a0ca8b7bdf9dc8839f7daa509f39a4ee2c37c641fa864d21fecdff0a651eacebcba02602e7f5f6cf165b1b89f1df004bb00a0a0d298a16f8da1adaa29c97a931ecd4"
                ),
                storage_slot=sp.bytes(
                    "0x0000000000000000000000000000000000000000000000000000000000000000"
                ),
                storage_proof_rlp=sp.bytes(
                    "0xf8b8f8718080a08d643d307c8ec38c44d5dcc6a221832949425ab1aed4469e82109fc0bc50066980a0b89398ecfe75a56ae5c7ece09a5104c217cf2d74ad165e0c26c7b062845f79f9808080808080a0e1c683b98bb77fb44e3301e8ef3c67e04559ee80ab57b59bdc59d5bd5898554e8080808080f843a0390decd9548b62a8d60345a988386fc84ba6bc95484008f6362f93160ef3e563a1a03100010000000000000000000000000000000000000000000000000000000002"
                ),
            )
        )
    )

    # Try proof after london fork
    ibcf.submit_block_state_root(
        block_number=7179835,
        state_root=sp.bytes("0x51ef75e6b8d780882fc5b708d06cd7938b0aad95ecbd12820af8055c2651fad9"),
    ).run(sender=alice.address)

    # Submit account proof for a given block (validator: bob)
    ibcf.submit_block_state_root(
        block_number=7179835,
        state_root=sp.bytes("0x51ef75e6b8d780882fc5b708d06cd7938b0aad95ecbd12820af8055c2651fad9"),
    ).run(sender=bob.address)

    scenario.show(
        ibcf.validate_storage_proof(
            sp.record(
                block_number=7179835,
                account=sp.bytes("0x7daEe65f9aA9028926deCE01cCfD0bD1B9320522"),
                account_proof_rlp=sp.bytes(
                    "0xf90c53f90211a08eaf6ebb8e1bb1a8eea303776055f7b2b1c74ef3b630ccb524416c7ab47c73cda07eeb37b7f8ea76566011d359cd72d2749eb83ebca08f5e541b18d8c99709c9b9a0bf4c24b0b032bae856fba0ae1edb5e363ad50d6b2e597af00d9150157afc7e25a03f7eb09872d36228948eb72a2cb5dc884d9bad5541812b038d11bd286312a456a04325c25ed1c87271825ea0c5617ce9ffc53af6fd0570a55e5ba1dfcf2e96792da0de2b583075dfed409c5a65d5890e6929b3e3c9a5b9e1c61cda1b70d84b7ea220a014534d7c9cb3bb695c943765f97355f041009300bbc55cb362f7604ece7de2d8a0e978c291fe15c76667eeb8a7589ace5f38718c6d1569875631443d30384bb512a05b187621d8643a1a344542dce2b27fb7ac7b50f9247b4d07c7489f4f247d1648a0d37e3dccab798819fa3eb97dffe50871fcdc725c4ffc3f09b83fae57fdb85f1aa0a03beb99e39f9157e4e0476a2eda6e68e29df1245488b37ae2c698112cfe4a7ea0a811d114469306486627734d8a3bd5207cf0054addfe631a804c9d5c607a912ea0e7d5a0ffb9da633f4d92421cf37da23776038d16c6cec05b77698c2f6c53a5a3a0932b0f145156fdf12fa3bf1574f6ad6065dd2e5ab652709e6ca8f47e3adbe5efa0e37025849eea1505c860a77507fdf800d7be4dea7192162bd759fa869fd16458a0506336426f3481ffb0319add732c895374610667f354b9243c0f0b19af269d8280f90211a038207fdc3b7521c09705afc7391e3c6adb4766efa4342dda718325fd8524c0e9a02b109f7b450d63b57afa25e3d2bd121f458c1bbd7d42cbb0624889e5d9fb6711a055e55ec69abfa867d03f1e554d5a450d1aa1f3e0257006a236db2e501038910ca09cd09cd71602059dc3b44afe5d1a13d062a9f718bca127e0a1d033d3c996c9f2a08816fa1848e847f2dfc2da95f84715824f9771b1b991ecd8f65bde390fde11afa0e0629cfa3879257b862930113009efd1eccc9b7a019061bf88ad38f0b41683a4a0acd21f084dd347e7a2f1baf72d8d3828a303d7187ee5d060728ae63a40334ceea07180f4b07ab8d296ca85d7e12a256d09d01121ac19a7d66805fc6ce4e1d586fda004ad949069ae83c0bd4b677908784b01baa7072c81d633ba9a23016304d180b7a0d5aa6ad4cfa51024598ec85e1d987fbfb5378e74166d24b7300b41346110d1a3a07f0217db68c4d5736045b8fd11545a6a384c266764ce7ce2b473f0239f29c81fa0510a76f022e865d0043fe111fa1343e9980871200f2426619f9c203c67b60e61a0800685ad27aa943dd01f64ad9acbec78b3843c90648c6246a5cb2142c8b14d7ca0e40e90d3a5c39d84323e78f830b4912c99343a18277e836848ca28a2a7f1a604a00f7efb94967018bc523fb61c44f7aabd4c921aba3b6a5f6ba7d1aa4473ec0470a0876d4c60081251092ec22db126aefd4f5d3676e5f8d52c3bcfb47f20ba71539180f90211a01418812492def8e5abac29cbe106579c74b5e08e40d3f44938443f22e0f20b34a0a704561ff1e2b1de9cc83e1100aaecdb8fb03c3af85f5de3a0197f04286225e2a024a84b3ea19574d04f33331eeeae2da712cdcefd3596036182e26b9c64be211ba00f4643285ccb0b5bff57e9dd852efb7ac99e1ac9c7cc662a12b0d12444634c6ba0db858ea10189efa17727d68a4dd538b5de912a42366488a2e33e7549cd05e164a01bca9d32ed8d26148bcb3d88ea358bd08b21b195a0d0ca2af125ace493364f7da00c4ee20a2401f125c50e465dfaf532a72683ad7f260d83cef19b1a3bd94e0325a00973b86408fdf47b9532b5ca1a8a8c4205f4afad6322019a17d72930b8fd8f90a075952915c053ff8e3f26e1d9e18c26b003fffec7ae3cf681f2a26c2f19e85bf9a06fbcc396a4630ca2f0b7ed941b2bfb2d0432cf8f5afae27e35a7f3b5553c3502a09b64ca83254c32717f35b81edda1e80132525b57a40bfe3108e895045fa03a78a0374a13a09dc40edb9e9a125159ea3ee8d26b57aade9697e572181c912da96737a03e7b3ad2c599449eec5daac44a8e2debff0f6054752f0f40d9219cccb7b33787a0a5ba91f16ca2e0a24379ad27e5c73bc0870ccc3d012fcbf52120327276d6bf7aa078e9aa6a6fe08641e7e34d4cac42e118dd958c5dd048508e3a5e22238e401c96a0807b0990f46405dcdb7e1ceac0cbb515b8783ba8269893e6bb5451d593e0a83d80f90211a0a6b11c1c10c1946db1c875208c0ead2a94edbb9aa42f8dbc7a1bdff82f587b1fa01511731577dceb39b7c7c096fc223d26accaadf01e4c1b9d4fde9bb0c58cd16ca0e10af52705710a7b28c56c89fe4995542c31aa26773b02880ab7f9c03bde7860a0fe4d40551600d653b489f779e6fceff2ea991c1fc84ebef7573a5d606a4cf29da0b451d89fd7781bbbb5fa4d9dcf76962977feaaa8f196a5026ebb29198388fcfaa0c2cb060012f46d8b70b687a28c8290ff1c8f20d475ffb911ea198e0ce77da02ea03f4d9ce25e3b0149eeb6e344f192c00cf32a9e81bd7cffabbe48630f2abb26b2a00a867a4827ec8d6b4511710cc924bc301b642afd4ad4f2d4000433138c80e0a1a035440a47a1afc0cfa000b5d66bd9d62a1dcfc086b65bcec79ee7564c0de22ef4a05786cd06b288a8d1dfe7aaf1a5d9af860291d630e9e610120321b33b099cf6b4a0720d9b1ee6d11ab6bcc63f3b7eeb7f3e7fab265f9637f0defee79851bdee89d0a0cc8301ccc775d7ae2eb0323922dbdc64ef7d113475c2b7034705a4e89e1ed565a0b757a57549571e3e99be553dc18450438099ea98726eaeb663b33de4cd905ed2a0934a707348fe85d0cdea7d192f7ee9833e011035bc270ae76582980c4ea73e4aa09e29016e4d6688acf05cc1076f92b6cd73279332aec57c3513d31283ebb63e73a0d60947b8a989b3416c8ee56827d32a37a654b684fe4d193133504edf4b04f03c80f90211a0a871491e5b929da4f3bc6fb9280062d5f76387c9ac0418c917a07e3203bf634ca0206a35ee85ed6a4c23195503cbfae6e32cefd72fde577e3894be442403c8bf64a06909320508992188cd0f2b5f417b5a1e4122b9e29765c41aa7fb90da1c70fd0aa0ab7d369b0f3ffe644d9f65a94b01ca21e655c4bcd06cfb332f7609a26955f98ca04f0a9f060d209a30be25adda85f648a38601ec0df850f4f9ea3157baf2451b2ea0d9e74ba1106ac6d054d5c40ca76d1d798ef8aa5efc19788de41bde2bddd18fb9a02213c86409a5b8b81c46ca9be306ebd375609676ba1487c338a9a7b4ade123a1a086c95c068df32e311982d5d5bdb4d2663ea756b0b4f486f987851c4797f5d81fa041e9304393573784e1158c36b3538b48647123a1b4696fa31fec146ed3230af7a0a4284f9ab2d0e99b59e22ca87297efdef7c4adcd177f01992588e3b17b371f1aa0aa63c261c542ceab16daa41935809ff3c2cdb360a2a2ed4b7feadeca8347ea2ea03b7018988b228fb8c11136112ab307482188f1e2bf7217706db87cb9720810e8a03f67a8062ea47c166a77b827b778201af6c2bb365965f322b024127d146776b0a06986529d536a4511c7affe6c3ea557a1f36d6effae62fc7c9c557276d3b9787ca098d1b970a680d7595f92224fbba919039c7753c8a0663e035998817d7e49cf3ba0f197618bc578a56aa1ad0e2f92e8e830e30ffde40db3419c85184fb19ca197f780f90131a0bcb355b48e34a1810bf16318e5fda0b3b4d13b0917d201ccf5cc4f411beabb92a02b5988931b7bdcde64b31059bfa56cafbff5e1396055038a05e3529027f6ac6a8080a0db5ad8d712315cc101403ea2eec4a1b6fd53a551659004846864a591e7e70fd08080a050386e923f1d64491e2c85db30c92bca10b5c1fbdc9c3289aa01469c443f93b7a0f1b377468ffbb0c483d90f15823dd5a3ccff71f0466e4b50298a5cc251835b97a09f0b569a7045b73d92262955b755245e350e5c94f0eb1c8f7d6e58d4425d4caa8080a0b24b79b089a47fc1674caa805f9445abf7bb1a7677fac085acacf7fa83fde77680a0c24c2cfa8bd482d61fc2a8b1bb4b59816ef52001b48158ed6f63bda7f408253ba0ab984464dc8740e51ed457c752b65a8ed9f574468571543d5a7da29dd12a49f280f8518080808080808080a08dc559bf5bd4548b32fcc32181d86612ba8b11f1bba9261c2ef7fe2f34557bef80a01a280c5a0987cc7c2cb878c376d6a2e27e22925c372f2ad15b9ae597a5ca146c808080808080f8669d380c5e978f3f36e8b029833fd159cba829a54e8d55e8c4e5f28b4831a1b846f8440180a0c53cbaddd072fc5094f0e0986a1baff9ed3d6dbe4133eb4e7764dd9e93f9ec9da04d9be648c5bf39973670d9f8b481d5d0b971e6a2db2deccc6b98cde21c5dd83e"
                ),
                storage_slot=sp.bytes(
                    "0x91da3fd0782e51c6b3986e9e672fd566868e71f3dbc2d6c2cd6fbb3e361af2a7"
                ),
                storage_proof_rlp=sp.bytes(
                    "0xf901ccf90131a0fe1cec69138a035b27919cba7d03d2f3b5867e183fc5928af3bc0b0f85b562a880a0e759fad30e475a8a7de20efb084aeaad48864ef0c5eb678f0133226a4489d5f8a0da9cbdd2154724e704491b792e162e096df39e9f51363b9b950933a61186820280a0de572a50aef9d550512795e67eaf06acda25ada12d45e5944fba2cb429641f5480a05abb50d3ee32dffe73e3a7f9f354bffe92e4971bf45b527d046208a6818120f980a0ca5985306e251400a05df43a16a3391bca6cf1e5a39acfde6f619c8ea03e3fbc8080a03783bc2fd4d98095264ccacf2098c92a04e317f93a82d87a713d645e0743ef8a80a0bb7fbc81f9cb125fa6229c00a3b6442d31316510f0a9054827bd2317fc95ac9ba0b60d522b76ccaef75c1d5d2faf67a3904ea0aadfe459950661a60e2111e94ca680f8518080808080808080a0ff1d82682091977c3bd249fd5840706e2c8f487add0b1ae09d430e80d9aeb8f9808080808080a066ba505307e91ddbb884cf21cfffd24941ca533e0b9384a68144039ab7fc57a280f843a0202ead72d53401d823f4de3290714b95c588de2c574133f57728a2d3d3763d3aa1a0f03ee4236f341d60bc114bdc519db37d120d1d98b8d3f12b9b6a65c2aa99b01d"
                ),
            )
        )
    )

    scenario.h3("Test proof validation 3")
    ibcf.submit_block_state_root(
        block_number=7179840,
        state_root=sp.bytes("0xc5940c342d98a51b878c26b914888ddece3f5ae30154171e7779d835f15893b5"),
    ).run(sender=alice.address)

    # Submit account proof for a given block (validator: bob)
    ibcf.submit_block_state_root(
        block_number=7179840,
        state_root=sp.bytes("0xc5940c342d98a51b878c26b914888ddece3f5ae30154171e7779d835f15893b5"),
    ).run(sender=bob.address)

    result = scenario.compute(
        ibcf.validate_storage_proof(
            sp.record(
                block_number=7179840,
                account=sp.bytes("0xa42F480ecA22C2c6FeB144Da92B27eb55a954a65"),
                account_proof_rlp=sp.bytes(
                    "0xf90c73f90211a0fc75b62d62faef00c943e35d89af1045aaa5996879dc7705a5107ca4e4a3faa8a0a4ba1ec0002756d639a465acf5878849833bda36910dbe95546c15940e788c4ba0e51e6af2f7497c92f6df99e75ff86b354a030fcbcf28b3489d7c7d5b81336029a05873a08717b96df1332540800f94367ab48efba6445dd6e37ce8831b0a133129a0d37c8128e873913c45654c693769d20b991da1f3eec11058c23d98d5fda24f01a0392f440e725312a60951946eab9e0008636fb1841488e3fe0e795f5f7608e5f5a06029c551a1aa1787d3f1cc6bd7c6a8d092716be97a64ccf8db43ccd58b00d2cea026fdd4d89c62de4945b9a229fe12ca45f0fb6c64b94039923cd39d140bc85892a019e8156d5ad7f6acec0dd2f17257a969fc67e43d860e919d104573e5d5099c29a034be012aca46104471700e7ff9705fc8b549e081e440a57e801fb552103ce622a090c97eb8e8c387b5ae1903249f603435ed218bbacdda82339fd2550c03289804a035e611e00e637a7ca049cc249bafa18458385ff8521fa301172d7e7813d070dba054b319bdf3e30797019a1c0fecc45962da8655db564225322b5c96df5880ee6ea0cdc685ed17185be2d9d4d6c56f4a301c43bf9b01dc2a4edd6bc3db0fe2c56ec2a075cab562d9be4da456705bf90d58f121e8c9c4162c29ec50119178d550052910a02325b92323b89f38d8f546a735bad1d7e3eae06a31f9505f7db82dcf9bab093a80f90211a0742db8ed7a28d82f45f7e7e50d65846026c054b1cae32053de6e3a08ccdc6abca0975e729ff0ebb752b8d190c46a8fed9ee6c2a4c8dbd8627e4ae3d774b6a66f47a0201fc08909f8966b92aeeade4c3e88d706388a122924f78b99d97de9def0186aa0829c7e84077832e34c4349be0a167b56338a2ec12c548c4e4b939373b874f269a072328dd64d4d38ad062789f20629c8c42fa35528b2733daefba2a7a8f533f778a0a7bfc5e4bf31c9b3643bf080802ab262b03ac436c5a19eb7b012bd044e0b1f81a0c097cc39bd901fe48982fd2c7fa3163def636a7deb8a5c2d94f5cc50f2a74387a0895c7c84b05cf55f9ee1fc8e327b6d0a3290b95b1b17de4dc0752ddbdcaf49cda02fa7cc4b97e840151797df3d3fd4aa32c6f8274766f444ddf553f5aa651f5928a073ee784d77218ae6665e954b1545e0a387c59a0dbbf22df1a5bd6c91a35b0c49a099aa03bde6288ae6dbffa426b875f9dde7da378bc3119d37b73da5e084531bd5a09c4965ffa869d728a178a447ed2aafd74f199bf5a76e2b6a503678cec3f22fa2a00345e73979cc3c5f9c29a526c2639459758649d949e47a4f5ae9376eeec9d92ca0ccc7b4efc8af89b789538bcd77d8c4cf3f101e4e1c31f1c4a50f6d269143bd42a0fb3256885fd7a5bd7f61541af414b7b039121f70c5f50cbb83d065c49d23494ea0f7e64450125b3fc25f3d445700e34f3ac99dfd9688dea2964b618d5e001a5c8e80f90211a0f8097eb53fc9123ed861a9beda50cf370eab083aeb8132b925fb1675d2fd7de0a01b19a97351f6ff343d0f67b624830399a6b83fbc9ab98228ef020f2c711f6a36a0546ac66d9348a3cbcb7ac2bb69b8e8c2e3b3271c05c97b5ce04211d81ba864cea05e98027d7c9d38e1696de748306862f68c5dfccc2f54d0fe9434df7b9e930865a05a808f30dfae42f0cc8b5ccd5a734db1d41a98fd687bb2b189951685c2d01c82a06a65080a49770354a719441c59a97ae2013ed8902ffffa25e6778ee8bf96b965a02fe8701595f8af85d823e877a1c4df01adc018746b8345331040508820a3e6d8a06616693a6bb1b5ad59e2a7fb5f33b2e0dcae3238ae91ee42e5699d37877f4d54a06c7bb8e69ced7e688ab6935e2a0781f83a1cfa5c47108f87e30daef7af8bdc39a0606a3569df8c64bfc52f46085072483b1bf8bc61d8acb72c57e33fc259a6d3b6a0b837e6a23098808ca0cd9a567768a58df68a656e4b16328a8a42cca4b855a92da0db71ddbf5992624f84889a1ebb84da60b5a0c5390c1c534583ec036da60304b1a09c246362c88440b1787dc7cd2997553316db896f7b53d69ca6a68cdcbf6cf992a0016f2e9ee7dea8f1da5355400f8cb7347794f9bf1a6aa29b44e5f8e745afd855a0a2ea3be3cffd8df411ac1f468ac389c668ac39e5174367fc481968449f4def46a0b8fa9a2d1cde7cbf90ec328e6bcd08ab4139ce860875865d316247267d187ce080f90211a084121b881c1865648f96bc7faed190095b0c9ba10f744f5f935c9610447fab0aa003558cc39a3b31a0331733a105db69fff2a3e126b34bfcd0da528d5ef11474bda0b1ad83b74376bfa0acee46debb038773a9b98c0e417a08332e029958076dca33a09da7db64cf8aaec1e1264d9db9f293446c9d1895c727701dd32062e5649902eaa084dc035adec38a80bff85b8335880e43d6920c144ccc2165b59828424125f08ca0052dacf85037a701a44b1aa66ce08ab203b89ba627cbcd38c87204fb287aca5ba07bba77aa3593d535e8f680d4fb7f3d20e428a2f2b59ada8e71a9c314891f10eda05d32da5fb5814b78095f648a1ac79ab58d226e7315cbb035b5ad1112dc910380a0238d2114d91a51b8e8d823060c8376425ac49e59b6772cda3576ec4f1844aff6a05821ee358661320000da4f12b6ac0c5fddca9879572212c3ad89484946d7bea2a03664ccaff2f12981207ace503c344beb138b52595ea4999bd388407411bcb26da0fb8e38dba8739cb23275e0b5fdc8ef8d099466eddd4f2ce9cf7283912a8ba314a0e1e40dc4269d26b382c2106cd9ee6cd8410f8ef406abe0830fe34050d15786a0a0c9f39e6dfa6945b5b36d00b87ff9ce508ef28b1652b9d5bd74d2e86e117eeeada0631ef82766115fb461b0dd6519b44bfc5272eb4edf222f29ab4ad3aff3944ff1a076dc14f7d0de55561357dad656bdd17329aba111e37a0a55d8398b518e8c848480f90211a0c7faf68c77f0c0cbbfa1e697caa4f8ba6103c1da4b4920dd32148fb1167d1437a0b547eba701b6d4f62808b0b3c8c5b6908cdd40a55d0215e04afcbabe71582cb9a0e11af90b2460c39d13294f97e0f1a00f1e52bea3bea49b9dc5b87b17165c1253a0b4f0e2fc3a83adbec65bfc325ed02e713f5c8351ebcc2462eef6911530b3eb3ca0edc9b25310dc29895bcebfb6d5511a234112efbe16b293cb9375088134dafd9ca0436ed4e8fa9c754116c3a7682778268a71349fa29b79dc022637dad56dcee45ea03d9d6e5e475f22f985cdbd66d4670da77435954e27d5101619eed5ce21ba0580a0ee165c216b4b8410643aa461504dc5fb02bb71764f7201e704cf1e7679f1fe11a0d279959023a5057b8d057b2be0bb8ff7588088eefbe77a30c820855ec2a5adffa02785c575f03e65f86480c728d9b1aba67fc86a63e85458f8e81da2fad7cc1ae9a0dd937cfdc5bd2c4d1c998efa4515d044e5f090c82eddbfa56fd63fdcdfe50a65a0bb3d04bd843b480dc642967f3ae450fbc304569c3fa7de5291b920c9aba89d02a00143f7f36914dfbcbb0e7c106f0cbc6ddbdc213cf8cb26af9de46803d2ae3fcea00b1c4afc086323665fd6a326faedad6f4c04761cd5f81cc91680423e127ef8a1a041acbff8395c8812c3fcee5768262ab40e136d318f331ad23f2fda19a3af83d4a093a2e4b744dcc2aa50d193933645b02d117f8539957ee5853dcc50b11b11364b80f9011180a075f7cd2716be0fde4bf67d3eef169f4aace297e1dfcd8fc7be422b022c1972cc808080a07605337d2d30d2a0ede47322fc4a978dd0fa0b03ce0675b03e5a999df5c4b853a02a164da56f20eff2bc1d7347727c931cbe856f69d48706ff89fb35b44cbf616780a0691b36f97f764af9056fbc28f457bbea7b38996fd4b30b22fa322db800ac50c6a071eba47dbf5422c4daf88e2bdb502c44963f6a31212af85524eefd22a8f7658c80a097792c5afebdf3de34c24a1acdd3e9bbeb542078c171bfe51a5893cd8945c0cfa04aa5948abfc4c15e077b8d3c21a6c2360ccc23dc5499f062e7e5e1215bbf55aea0f982a14cca6baebe853641b14420728b72ccb6b97cabc049923a7ce803f4bfd5808080f89180a078527871b398c27ec624deabd10b76700c91db31419a34d4d9bf43bef2ab0131808080a0e0ea2b6dc2b7ceb1d9f0b323bb641ef1cc7cfcfe70b0f648108fc956b03f87fa8080808080808080a06beeb4b717a3fdbfce2f8667adbb3f97e8ab13970005b7dad354519cf9cc47afa08145dd6a7f49f02b28106bdcc007079b4699d95f8011331fb7481f50e624c10880f8669d3f8a04053117766c0fb7d26a8f86c00d5c8abdf86aa1a66023d0e7ffd6b846f8440180a0c0a901ab3224f0854bc99153635d0d2ef438a182ddf10018a449603dae5b3430a000db05da5b2655e7e5a528336a5460a7ee30704ab8e0d1835ea54645ef5109c8"
                ),
                storage_slot=sp.bytes(
                    "0xb39221ace053465ec3453ce2b36430bd138b997ecea25c1043da0c366812b828"
                ),
                storage_proof_rlp=sp.bytes(
                    "0xf9018df8d180a063f3180492964cc451386710a756e5630f34c42c2963f22806db12f69c2b9dd1a04fc5f13ab2f9ba0c2da88b0151ab0e7cf4d85d08cca45ccd923c6ab76323eb2880a0347dadb8b3c07fa6380131805c8e47a3c692d65c6a2362f85742733be4617d5e8080808080a0127b8c6ab177cc910647c9c1f0352d7dc2c4e0312e348d91aa2cc5f27de73212a0a1f8529dee8635a60f990bc58a351da88dd513ae107bd68ff35edb51f154f789a0f318db4a726bbc999962a9038eb9ce393bd640d84f1c036104e576eba84dec2680808080e212a0837337bae61d2f1547d0fd1ae840236315561c408f6923f9314ee8b8db2ed425f85180808080a03294a1560ccd4a780c13224456f8e26ee2691d7e6e20fe1cf9ba6f62b055403c80808080808080a02be99ee69942ae5957889cb139b5b175a740c89d856ffe6264382c8adf1926b380808080f8429f301e68d452ad3af4aed95d6e19d1a690ed00a9a5bee1b2b0a83b6028446a4fa1a013d3f60001a5464f5eae7f652469d0387f9e9a76466ad88b0b989da0d981e430"
                ),
            )
        )
    )

    scenario.h3("Test proof validation 4")
    ibcf.submit_block_state_root(
        block_number=7179845,
        state_root=sp.bytes("0x165f651aca44dc76ac642127d4a904b2270b22459c13b1bd5a360ea25f314f1d"),
    ).run(sender=alice.address)

    # Submit account proof for a given block (validator: bob)
    ibcf.submit_block_state_root(
        block_number=7179845,
        state_root=sp.bytes("0x165f651aca44dc76ac642127d4a904b2270b22459c13b1bd5a360ea25f314f1d"),
    ).run(sender=bob.address)

    result = scenario.compute(
        ibcf.validate_storage_proof(
            sp.record(
                block_number=7179845,
                account=sp.bytes("0x57e796ff645719FC98b9Be0b3731F1605Ed98c5e"),
                account_proof_rlp=sp.bytes(
                    "0xf90c73f90211a0dded1ea1ded6da9ae53a491896a34344c885a87123a0fc3406403c40dada8fe1a062fad4c414d0968b0d4b61b06abe4a12785c05dc94f2052087a24603377a1127a0762dbe56774d5c2f74f3bc62eebbff2c1ef8d622e044d763ef46a9c6e05b0895a024e16ad0a70f8e2a373cd20fbcb1beefd236930c9e80972676ee75e71376f748a05c0b8e998808ff95805f6e6d114aca2bdbc3c8a05cac100caa83453a80fc551da084cc118be70d76f1d7d45e731adb32a5ea98194f1e55e12e8a81c1265bb35804a0cfe0d0d5a659bf87435d9175311ce312a99fde37a714844fe8a86b6671485b29a014d0b6e6bd843f8f5652a691b07e8bd57d8daefebf68518dfa1ca2c27371c955a0e59a89693faa726341f6eac51e893e81bcdf3983788bfcf88cd35e85f2692072a074ad7d620707530ae12cef2d83f28cfa6b381176f2f17dda157f3d94194c3edaa060e8042b25a70cbdb5b7bf7acd57e96f389f8c5ca61568a3d104bb6e89410397a00be1c2a477f8eac3a4ba620b959b4e9702f919ef860337420a3dce5be814158fa091dff9cd84917e1dad5c65c824aa549be1e2b537eaa84adebbf0c7a34c0516b8a09db42f5adcc060c2fb368c2b5b5f2df2bd432018e76c5497305cf9ab040ece2fa0827453674aa8a0721788852fc341b097c451b87949198314a6df7bf7640c34bea0926595591284d182861c26ea9e71e86c7b9f8ee3b6859ee29113ebe08026916b80f90211a0ee8f768253ed6c37765832d64884a5e092e41cbfdaf0fb8f0932211ce0d568c4a0ce495a7fa0836aaeab91fbbdc7dea5ce1aa96b857fd1a8e39f86f254010f2973a0491069c53daf75d1997636cf24365e3df2fb7b0c1f473512f4015bccd7c0c495a0bc5e1a2ff02cee76141ebbde7e11ef1cde35ea2870dfb9c86c3686a1149359d3a0981b41642f7de62e3b86aacbaf87550fd5e6cd25fa74184b83547adf23a22fc5a0fddadd87475a00c34bb9d6f0247c6f2e1aa35a9ae3f704e053a8a5c2ce5c3913a073f979076c82f9b273fdb1490eed2a42118a22657e9e4aff5531b9434b601bf1a034f4c189b0d5b87be223f8d9ded6ea924b183ee5cf6559406de3c8c0a748df0fa0ad24cc8adf2c208cd3b4a618b16bbf9ad14caacd2b07fbc90bb62df6be85496ea0ea35325f678defc5ea53d77a23a293fc68c2d0b39fb1231466cd6c234da540b8a00ba70a69e36fa88db1d0eaa49c5b55e898560a8f7eefe11b6784020be2dbd8f4a0b3caf50d4308581d338e3ea7c22525d82188aebbee020b632587460edeae4af8a02272da0b5d0a15df06e7afbcb3c72d46f014ff8ffc767fed67bd913f7726681da0b7e7835994dcd6ff3b2acb150d385946911e12cff2deebce7b2c1d330443812fa0eaf2a4492c71a0c4f472d0def98e87407968800bef137205774089c5f516fcd4a093473cfe514cb3d370ab4be46ac4e5f4d7789246018164ce27b0aa67f389665e80f90211a03467744e52388cea47422c20dd914ba06b7774b831b6495bb4698c15d389148ba088525a844b5a5d4d8ef78f2a3778ed158134c67bf398c7d3bdf75eaeecaea572a05eb80f9c3226203a10218dc0fae5ae105405d88965dae3f54e8182a78cce661ca0fce6fb480556411a6154d06549bb13faead17c58ad5a2f007dd15c27c8b71ab9a039ce7123fca637f72e2453bf5fb6d41d339c9ed89d952528b2834864b3b95380a049082b9365e9191eae486a26eb45c46b86c684f1e681262ab2901e8966f00e9da0d4033860fd491626ee7b19e5a139740adb20b20681a4caa3476d192bbe0fb394a0c93505a507ac2a8c02679f893abd01c472a1d4f55da00fdc761d8b05ec3af045a0974c124e54de2d0d35da4e8f96e0e79594f1fb8c89eb9988dcce906ba03000a4a0d2b3c203d5ec947f1a8fb4d1bb9d0c988543f26aabbc41348e539a1611b2f1dda08829379b6999f03962ed414b65a0a23eb969525a0ad183182c32b116cc889be1a0721b85e9bb81dba6362be176d5a335ed706ba83d0e977ef7621d72060d84e28fa0174f7dc9393883bcb4439c7af8b090e45edd7e812908bd8ff47903f371471fc3a0713ab60afd75ae70440f07eac886187729e27b06f760f056e81cf2ea72b766f0a0197b0c5479eb956a72b7b52e5b4a6c2617afb71d7437559f208850d3b2fac728a0d8a6b21e99114d2bcf3ccc468bd6bfd3c6cef707c930b709294e90b537d20ead80f90211a0ff0a1740e1d2306fe57d45a2a282ac854ba247fef3d5b2bc22e83ee38a381578a0d2e14547273fc537625a75c302f56ee66cebc4768a150cfe58001566d7aa2d7ca010ee81a990481ea9d551664be71e8d9151dc05c2e11f9580f744b4c2a797ebfca037d54c4a3a414ce5b1dd5b05f54c3f9eb188a83f211d10e9856f3aee9fbe6c13a0afd0cb95be49860f9374c39afdb6bfff7bb920c1fa2b43713a62496198756b97a0316aa0c4bab2b1863dbfa2ec6ebadb68177d2af31c9801320c7ddfd26837a754a09a22b6f4e8b3bc901cdf1904c52a74f60e467521b71571c8919291e38ce646d4a09a67f363de88b930c48910acfe09799e88ad844ddbfe13cd644e755e99007694a0d0ebf268b32959711320592556273d90a191832efb32dad8313e454ac89b1203a00fbd113c8f88fa023ef525f1e963ba11cb31926bfd8e78e4a3d3a494cf011da6a086e5af77f6983dff46261e4ae6b04b26af984341fdb8820371b209c07baa8b31a007905fa7cfd6e1e359772711455b981134fc3a61748229d8a8fd0e38e7b4345aa077948f4f9040d14cfbfb4e6a4d998665c2284e6e613f5d6cd66e5b34e58fd7f9a03b86f28bc11cee028ed3b69fc2561ccb55b8563225537db8fce33cd7346b52cca015ca6665e74023a3d81068daf162f1dcd99880d0d0b9c4c08bc7a9011bcbe31ea051df22083c50d8216e7ae63ff8386c8e013ebfe146ac088cc068e8a98fbf5e2080f90211a0f8e2caf4bfbd2387b011ae9b4e0434c4ef6c17fb7104bd3851ca9aa14c4c7be3a0b206684c96b45284dc843db0ef51474ac844697367d1e5f7a4b09b1d5b88b158a075a3fa28669ab58184a2e5bcd13eb55bf4751cfb4860c8074ff70442494d2229a019045885703bff231764c236c2dee89caee45ada51cebc30b8c2efe81a9f3782a0f453685df20ca90e4d1d642f1473139fff91f4436902baae4e704ad26976fc7ea05001ac402c71ec49abe1c679a5c6fd4fa0e55f49c597bec9d76de9cbf3ff5c08a013a1e86fe06edd27811e5129ea1730110de04bbd34e9a7bee5b717ec0023b78fa0a5e1c975d1f3ccb82efb8fbb767d9ce88851e034d9744837d59ca93b3f6c685ba07a0663e7103382619141edebc678ad5dedadb7aaf85c58289601fd583a35812aa0a15e7842d62674143b0e47ec04e5112e67d45ae9f89abdf73a421f0693a782e7a027b21a1eb9d192bfc7c24029690a3ccbe16771b82830dbe86ebf8e1be58aa8a0a0331021dc66a180e92ac2e1612db10bef58e6b79e86c1823c2dd5a906240a0930a0cb5bfa5dd659f5b0fb20ef8cc9471fa0abf204109e5486320f58d0d930c3c77ca0a0f05d5b9e5364abc8803976ba186997edafbac57fd64fa92a653010f62415b5a0001b4772a49facffbfd536e0e2dd12140dd71adcdf5a7e6d489e329b061b2585a0a029809ef5d8d359bd8f7fecf169578d49c6010a64b32c8649bd46e1bbfa65ea80f90151a06801d40737cad61186b939eb4104c5502273d26c535f7a37c34a63abf6e4dfe980a0b31f02a6b752f8eba131c4ec775ce0444ad2857792d19ccf587726dce76a273280a0027f124239b915e70ef1a986bfe2dfac456fd44237382307eb754ecd44e3821280a036ae5c8e0cc6004f5d1d4c66c236f7930ba2f64cbae6d9f0363876e47a01445aa0afd1c866b64cf9611d0c3989dad1a383fc035cb72c0bcd0882444d77ecbe0cf18080a0fa1915f63b7faf7d5b2a76aaeeaa9a61a7ed451c1f4718e8bf3e5af77581eac8a0e91198c91dcacf9d20eaadff1f6532676f2e377287e68c88b043d2aefe8e9119a096f9d03774a23f2570ffb8cc4298ffc267f4364bc746069975f21c45726fc71a80a00442927e748e876312dea52b28dfccfcf0b18b3daa10e62a317c40e858dbb201a0e88950e7888948366eb14c601bbc63a1ca546fba0aedfa5a38df928e5ee7982f80f85180808080808080a084e54b0b5c476fbaae3840e18ea5f1b54d2cbfd4b5d11c3945113253b2966836808080808080a0e71dfd63f0c4ffd6568e8230d4ab61ff8a344ee88295aa8da2c6a5eea96960288080f8669d3eba0fa7e2848bcd30e1bf958707d2a02f8f03ae438d6622a21b562c7fb846f8440180a0ab4f5e5ac89f9bed9eab40a5b02763168e73ca32c5dd9f5ced76ae92815e42e1a03c789e7c0b32cfb991ed499ea05ca68b7ae8e89f5ed2bbf04deb5878c4018f68"
                ),
                storage_slot=sp.bytes(
                    "0x89832631fb3c3307a103ba2c84ab569c64d6182a18893dcd163f0f1c2090733a"
                ),
                storage_proof_rlp=sp.bytes(
                    "0xf902ccf90211a04d6190501267fd3b5a9d1223d003b4bf5ae76063514a1033389b366426814821a070bf5d648f0dc17e554de24b7f1b7c803652abc65f216feaca4e1173eb334b10a079e72bd9aac24a2713cd23c2e3e838573073440d39c696b37b9a00343c590433a0d0dfa426aabf2e1cc49d1c4e990de5b4acf44d45337c2ffbd7403e9f3e76dd2ca0e03f9e0f2f37b58194656eda176816309348200438b94ed468f49f9b52539003a0fbb5f5c46cfbbec7dfaca1ab5bb383bb53f1f4b92ac955b7577c79877fb4a757a09eabfc1cafe877b5a9c85323492bf327c6be4ba87c0e575312f8a3ac0dd11707a09fe41785607793ac153fc5fba450a0ce95778bf772d42cb6514f152624622ab8a02018a6ee674122dffe10c2c7bfc53d032db313f05ea83fb254735f419611a37ba0d7a47dc607220e44942fa5f4c0475ae561777f2b13481d019dc69d474aab9f35a01d93a510fea6b836e1a07a7ce7dcaf42c46f60d2b136e0183e43d833069c36afa0a0d044a21761c2fd8ef694e0e06ccfb0d27f51d99049727fd06237b43835ad0fa00116e6173243473e292370aa7429b693bb8527192fe171dc25e642ddac35c42da0e0f4f15f3f45246a720e396433f58d0a5efcc3bd2c41ea4c1a9e7f91fdd03f88a068eb77e2f812d622596e51c1cb7ba59e9ea9984c9d692a615ec3b75705a6c386a09afddeaad8be58b213f1c59683b25729c4224d94d1d578954331416a8320113a80f8718080a056ac2bf3a1e15140f45dd68a0c792972607b081b6632744d199ad0fea6737c85808080808080a09eb6b46c969d6d257a7c50b402407583a062452a9a734f91aa091a1d4af8d3d380808080a043af85dfbcc3c4ecb1143422355e6716a57c711b40c0a972c3798eb7954cf0d48080f843a02069ad09c79cd38934b567412ffa82bf024fcb938a8b7ec112fb038de5047bb2a1a0f03ee4236f341d60bc114bdc519db37d120d1d98b8d3f12b9b6a65c2aa99b01d"
                ),
            )
        )
    )

    scenario.show(("Value from proof: ", result))
    scenario.verify(result == sp.bytes("0xa0f03ee4236f341d60bc114bdc519db37d120d1d98b8d3f12b9b6a65c2aa99b01d"))

    # Test lambdas
    scenario.verify(sp.build_lambda(Nat.of_bytes)(sp.bytes("0x0211")) == 529)
    scenario.verify(
        sp.build_lambda(RLP.Decoder.length)(
            sp.bytes(
                "0xf90211a0c8cd46af1b79ad42fa13a2f33da7bc1dbd2e5802fd416861f1fdc5a13e8940dda05bc496c81f8fcad9374386ce23cb05f12d0422dae3e84401870afb0f1beb4adaa0e235390a4551a62b1ac43a4a9be3c78f1e9ef04fe59cfcd087c72fccf0866e3aa0b4bb9cf76540eb61240b9c8a2d8fb0fdf2413544f13b177f5d2c69b6e61b1741a0a65176bed8f8f40eee1837776bb87683d0b2fa148ccc70e6d3da58df6761e813a02ad741a9e23d6ea154239a9e6a590800ed0e54b7baf83325f5a92e0b2db62b72a0d8ab9cecfc1e1d25e55031b9b31b10c9e8698ce4420bd921995c504932c91a21a01ec2e40343ae9dd8471f6ea9ffe48a4c99d42c664c05b0aa0a8c789b6bcd1342a08ad1a6dbc533492153df645f1ed30a7c4bc7327893e45634671e718ab53e69b1a08fa341768d72b9f310e2636225e0b9dbd906732d88eb3ccf786d9445c10511b5a05281ebf7637dc8e8d4b3fdd13a3587d48a7ea08d67035a09ec1fd2dd8fe62d7aa0681d05338c42c9c274eda6194d37bcd60630193b1fe4e21fd54ffda79ab436d7a0ebff770ac316f78cf27576a8e41e8d58599ed264fd68c2de1e13c9db02d2f156a0e056158ceadb4d6e97cf1e8406d311707f3860259413edd51c4ee170efa7fa1fa037497d736f3db69217cb3e72e04ea38faab08ed965caaa7701ddacb772bebacfa0ba76449bd47af7709f436294db9709983571648428c24cc8a4ff0d4fa3ef331880"
            )
        )
        == 532
    )
    scenario.verify(
        sp.build_lambda(RLP.Decoder.prefix_length)(
            sp.bytes(
                "0xf90211a0c8cd46af1b79ad42fa13a2f33da7bc1dbd2e5802fd416861f1fdc5a13e8940dda05bc496c81f8fcad9374386ce23cb05f12d0422dae3e84401870afb0f1beb4adaa0e235390a4551a62b1ac43a4a9be3c78f1e9ef04fe59cfcd087c72fccf0866e3aa0b4bb9cf76540eb61240b9c8a2d8fb0fdf2413544f13b177f5d2c69b6e61b1741a0a65176bed8f8f40eee1837776bb87683d0b2fa148ccc70e6d3da58df6761e813a02ad741a9e23d6ea154239a9e6a590800ed0e54b7baf83325f5a92e0b2db62b72a0d8ab9cecfc1e1d25e55031b9b31b10c9e8698ce4420bd921995c504932c91a21a01ec2e40343ae9dd8471f6ea9ffe48a4c99d42c664c05b0aa0a8c789b6bcd1342a08ad1a6dbc533492153df645f1ed30a7c4bc7327893e45634671e718ab53e69b1a08fa341768d72b9f310e2636225e0b9dbd906732d88eb3ccf786d9445c10511b5a05281ebf7637dc8e8d4b3fdd13a3587d48a7ea08d67035a09ec1fd2dd8fe62d7aa0681d05338c42c9c274eda6194d37bcd60630193b1fe4e21fd54ffda79ab436d7a0ebff770ac316f78cf27576a8e41e8d58599ed264fd68c2de1e13c9db02d2f156a0e056158ceadb4d6e97cf1e8406d311707f3860259413edd51c4ee170efa7fa1fa037497d736f3db69217cb3e72e04ea38faab08ed965caaa7701ddacb772bebacfa0ba76449bd47af7709f436294db9709983571648428c24cc8a4ff0d4fa3ef331880"
            )
        )
        == 3
    )
    scenario.verify(
        sp.build_lambda(RLP.Decoder.list_size)(
            sp.bytes(
                "0xf90211a0c8cd46af1b79ad42fa13a2f33da7bc1dbd2e5802fd416861f1fdc5a13e8940dda05bc496c81f8fcad9374386ce23cb05f12d0422dae3e84401870afb0f1beb4adaa0e235390a4551a62b1ac43a4a9be3c78f1e9ef04fe59cfcd087c72fccf0866e3aa0b4bb9cf76540eb61240b9c8a2d8fb0fdf2413544f13b177f5d2c69b6e61b1741a0a65176bed8f8f40eee1837776bb87683d0b2fa148ccc70e6d3da58df6761e813a02ad741a9e23d6ea154239a9e6a590800ed0e54b7baf83325f5a92e0b2db62b72a0d8ab9cecfc1e1d25e55031b9b31b10c9e8698ce4420bd921995c504932c91a21a01ec2e40343ae9dd8471f6ea9ffe48a4c99d42c664c05b0aa0a8c789b6bcd1342a08ad1a6dbc533492153df645f1ed30a7c4bc7327893e45634671e718ab53e69b1a08fa341768d72b9f310e2636225e0b9dbd906732d88eb3ccf786d9445c10511b5a05281ebf7637dc8e8d4b3fdd13a3587d48a7ea08d67035a09ec1fd2dd8fe62d7aa0681d05338c42c9c274eda6194d37bcd60630193b1fe4e21fd54ffda79ab436d7a0ebff770ac316f78cf27576a8e41e8d58599ed264fd68c2de1e13c9db02d2f156a0e056158ceadb4d6e97cf1e8406d311707f3860259413edd51c4ee170efa7fa1fa037497d736f3db69217cb3e72e04ea38faab08ed965caaa7701ddacb772bebacfa0ba76449bd47af7709f436294db9709983571648428c24cc8a4ff0d4fa3ef331880"
            )
        )
        == 17
    )

    scenario.show(
        sp.build_lambda(RLP.Decoder.decode_list)(
            sp.bytes(
                "0xf90211a0c8cd46af1b79ad42fa13a2f33da7bc1dbd2e5802fd416861f1fdc5a13e8940dda05bc496c81f8fcad9374386ce23cb05f12d0422dae3e84401870afb0f1beb4adaa0e235390a4551a62b1ac43a4a9be3c78f1e9ef04fe59cfcd087c72fccf0866e3aa0b4bb9cf76540eb61240b9c8a2d8fb0fdf2413544f13b177f5d2c69b6e61b1741a0a65176bed8f8f40eee1837776bb87683d0b2fa148ccc70e6d3da58df6761e813a02ad741a9e23d6ea154239a9e6a590800ed0e54b7baf83325f5a92e0b2db62b72a0d8ab9cecfc1e1d25e55031b9b31b10c9e8698ce4420bd921995c504932c91a21a01ec2e40343ae9dd8471f6ea9ffe48a4c99d42c664c05b0aa0a8c789b6bcd1342a08ad1a6dbc533492153df645f1ed30a7c4bc7327893e45634671e718ab53e69b1a08fa341768d72b9f310e2636225e0b9dbd906732d88eb3ccf786d9445c10511b5a05281ebf7637dc8e8d4b3fdd13a3587d48a7ea08d67035a09ec1fd2dd8fe62d7aa0681d05338c42c9c274eda6194d37bcd60630193b1fe4e21fd54ffda79ab436d7a0ebff770ac316f78cf27576a8e41e8d58599ed264fd68c2de1e13c9db02d2f156a0e056158ceadb4d6e97cf1e8406d311707f3860259413edd51c4ee170efa7fa1fa037497d736f3db69217cb3e72e04ea38faab08ed965caaa7701ddacb772bebacfa0ba76449bd47af7709f436294db9709983571648428c24cc8a4ff0d4fa3ef331880"
            )
        )
    )
